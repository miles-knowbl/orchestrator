# Index Generation

> How to create and maintain documentation indexes for discoverability.

## Purpose of Indexes

Indexes serve as navigation hubs that:
- Enable agents to discover relevant documentation
- Provide quick access to frequently used docs
- Show relationships between documents
- Track documentation completeness

## Index Types

### 1. Tier Index

One index per tier summarizing all documentation at that level.

**Organization Index:** `~/.claude/INDEX.md`
```markdown
# Organization Documentation Index

## Quick Links
- [Global Instructions](./CLAUDE.md)
- [Organization Dream State](./DREAM-STATE.md)

## Systems
| System | Status | Dream State |
|--------|--------|-------------|
| orchestrator | active | [link]({repo}/.claude/DREAM-STATE.md) |
| dashboard | active | [link]({repo2}/.claude/DREAM-STATE.md) |

## Loop Definitions
- [engineering-loop](./commands/engineering-loop.md) — Full engineering workflow
- [learning-loop](./commands/learning-loop.md) — Pattern extraction
- ...

## Memory
- [Patterns](./memory/patterns.json) — Organization-wide patterns
- [Calibration](./memory/calibration.json) — Global estimation calibration

## Recent Activity
| Date | System | Loop | Outcome |
|------|--------|------|---------|
| 2025-01-29 | orchestrator | engineering-loop | success |
```

**System Index:** `{repo}/.claude/INDEX.md`
```markdown
# System Documentation Index: orchestrator

## Quick Links
- [Project Instructions](./CLAUDE.md)
- [System Dream State](./DREAM-STATE.md)
- [Architecture](../ARCHITECTURE.md)

## Modules
| Module | Status | Path |
|--------|--------|------|
| skill-registry | complete | src/services/SkillRegistry.ts |
| execution-engine | complete | src/services/ExecutionEngine.ts |

## Documentation by Category

### Specifications
- [Requirements](../REQUIREMENTS.md)
- [Feature Spec](../FEATURESPEC.md)

### Architecture
- [Architecture Overview](../ARCHITECTURE.md)
- [ADR-001: Hierarchy](./memory/decisions/ADR-001.md)

### Audits
- [Security Audit](./docs/audits/SECURITY-AUDIT.md)
- [Code Review](./docs/reviews/CODE-REVIEW.md)

## Memory
- [Patterns](./memory/patterns.json)
- [Decisions](./memory/decisions/)
```

### 2. Category Index

Index for a specific document category.

```markdown
# Architecture Decision Records

| ADR | Title | Status | Date |
|-----|-------|--------|------|
| [ADR-001](./ADR-001-database.md) | Database Selection | Accepted | 2025-01-15 |
| [ADR-002](./ADR-002-auth.md) | Authentication | Accepted | 2025-01-18 |
| [ADR-003](./ADR-003-api.md) | API Design | Proposed | 2025-01-29 |

## Status Legend
- **Proposed**: Under discussion
- **Accepted**: In use
- **Deprecated**: No longer applies
- **Superseded**: Replaced by another ADR
```

### 3. Search Index

Machine-readable index for agent discovery.

```json
{
  "index_version": "1.0.0",
  "generated_at": "2025-01-29T14:30:00Z",
  "tier": "system",
  "system": "orchestrator",
  "documents": [
    {
      "path": ".claude/DREAM-STATE.md",
      "category": "dream-state",
      "title": "System Dream State: orchestrator",
      "tags": ["vision", "progress", "modules"],
      "last_updated": "2025-01-29T14:30:00Z"
    },
    {
      "path": "ARCHITECTURE.md",
      "category": "architecture",
      "title": "Orchestrator Architecture",
      "tags": ["design", "components", "mcp"],
      "last_updated": "2025-01-28T10:00:00Z"
    }
  ],
  "quick_access": {
    "dream_state": ".claude/DREAM-STATE.md",
    "instructions": "CLAUDE.md",
    "architecture": "ARCHITECTURE.md"
  }
}
```

## Index Structure

### Header Section

```markdown
# [Scope] Documentation Index

> Generated: 2025-01-29 | Last updated: 2025-01-29

## Overview
Brief description of what this index covers.
```

### Navigation Section

```markdown
## Quick Links
Most frequently accessed documents.

## By Category
Documents organized by MECE category.

## By Status
Documents organized by lifecycle state.
```

### Content Section

```markdown
## [Category Name]

| Document | Purpose | Last Updated |
|----------|---------|--------------|
| [Name](./path) | Brief description | 2025-01-29 |
```

### Footer Section

```markdown
---

## Index Maintenance
- Auto-generated by docs-alignment skill
- Manual updates: edit INDEX.md directly
- Regenerate: run `docs-alignment --index-only`

## Search Tags
#orchestrator #mcp #skills #engineering
```

## Generation Algorithm

```
1. SCAN all files matching documentation patterns
2. CLASSIFY each file by category and tier
3. EXTRACT metadata (title, tags, dates)
4. GROUP by category
5. SORT within groups (by name or date)
6. GENERATE markdown index
7. GENERATE JSON search index
8. WRITE to index files
```

### Metadata Extraction

From YAML frontmatter:
```yaml
---
title: Document Title
tags: [tag1, tag2]
category: architecture
last_updated: 2025-01-29
---
```

From content if no frontmatter:
- Title: First `# heading`
- Tags: Inferred from content keywords
- Category: Inferred from filename/location
- Last updated: File modification time

## Index Maintenance

### Triggers for Regeneration

| Event | Action |
|-------|--------|
| Loop completion | Full index regeneration |
| Document created | Add to relevant indexes |
| Document moved | Update paths in indexes |
| Document deleted | Remove from indexes |
| Manual request | Targeted or full regeneration |

### Incremental Updates

For efficiency, track changes:

```json
{
  "index_state": {
    "last_full_scan": "2025-01-29T10:00:00Z",
    "documents_hash": "abc123",
    "pending_updates": [
      { "action": "add", "path": "new-doc.md" },
      { "action": "remove", "path": "deleted-doc.md" }
    ]
  }
}
```

### Consistency Checks

```markdown
## Index Validation

- [ ] All indexed documents exist
- [ ] All documents in scope are indexed
- [ ] All links in index are valid
- [ ] Categories match document content
- [ ] Dates are current
```

## Agent Discovery Protocol

When an agent needs documentation:

```
1. Load INDEX.md at current tier
2. Search quick_access for common needs
3. If not found, search by category
4. If not found, check parent tier index
5. If not found, use search index JSON
```

### Search Patterns

```bash
# Find documents about authentication
grep -l "auth" ~/.claude/INDEX.md {repo}/.claude/INDEX.md

# Find all architecture documents
jq '.documents[] | select(.category == "architecture")' .claude/search-index.json

# Find recently updated
jq '.documents | sort_by(.last_updated) | reverse | .[0:5]' .claude/search-index.json
```

## Best Practices

### DO
- Keep indexes at the root of each tier
- Include last_updated timestamps
- Group by MECE categories
- Provide quick links for common access
- Generate both human (MD) and machine (JSON) formats

### DON'T
- Index draft documents
- Include full document content in index
- Create deeply nested index hierarchies
- Manually maintain what can be auto-generated
- Index external or transient files

## Index Templates

### Minimal Index

```markdown
# Documentation Index

- [Instructions](./CLAUDE.md)
- [Dream State](./DREAM-STATE.md)
- [Architecture](./ARCHITECTURE.md)
```

### Full Index

See examples above for complete tier and category indexes.
