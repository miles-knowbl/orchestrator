{
  "id": "docs-alignment",
  "name": "docs-alignment",
  "version": "1.0.0",
  "description": "Scans, updates, and maintains all documentation across the Organization → System → Module hierarchy. Ensures MECE (Mutually Exclusive, Collectively Exhaustive) categories stay aligned after every loop execution. Handles document lifecycle: create, update, move, prune, summarize, index, and cross-reference.",
  "phase": "COMPLETE",
  "category": "meta",
  "content": "# Docs Alignment\n\nMaintain documentation alignment across the three-tier hierarchy.\n\n## When to Use\n\n- **End of every loop** — Automatically triggered after COMPLETE phase\n- **Dream State updates** — When vision or progress changes\n- **Cross-system changes** — When one system affects another's documentation\n- **Periodic maintenance** — Manual invocation to clean up documentation drift\n- **New system added** — Ensure proper documentation scaffolding\n- When you say: \"align docs\", \"update documentation\", \"sync docs\"\n\n## Reference Requirements\n\n**MUST read before applying this skill:**\n\n| Reference | Why Required |\n|-----------|--------------|\n| `mece-categories.md` | Understanding the MECE documentation taxonomy |\n| `document-lifecycle.md` | How documents flow through states |\n\n**Read if applicable:**\n\n| Reference | When Needed |\n|-----------|-------------|\n| `cross-reference-protocol.md` | When linking documents across tiers |\n| `index-generation.md` | When creating or updating indexes |\n| `pruning-rules.md` | When removing stale documentation |\n\n**Verification:** All MECE categories have current documentation with valid cross-references.\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Alignment report | `{system}/.claude/docs/ALIGNMENT-REPORT.md` | Always |\n| Updated indexes | `{tier}/INDEX.md` or inline | If changes detected |\n| Updated Dream States | `{tier}/DREAM-STATE.md` | If progress changed |\n\n## Hook Integration\n\nThis skill is triggered automatically via the completion protocol:\n\n| Hook | Trigger | What it does |\n|------|---------|--------------|\n| `docs-alignment-hook` | PostPhase (COMPLETE) | Invokes this skill after every loop completion |\n| `dream-state-sync` | PostToolUse (DREAM-STATE.md) | Validates hierarchy consistency |\n\n**Note:** Hooks handle automatic invocation. This skill performs the actual alignment work.\n\n## Core Concept\n\nDocumentation exists at three tiers, and each tier has specific MECE categories. After every loop execution, documents may need updates, moves, or cross-reference adjustments. This skill ensures the documentation hierarchy remains consistent, discoverable, and accurate.\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                        DOCUMENTATION HIERARCHY                               │\n│                                                                             │\n│  ORGANIZATION (~/.claude/)                                                  │\n│  ├── CLAUDE.md                 Global instructions                          │\n│  ├── DREAM-STATE.md            Organization vision & progress               │\n│  ├── memory/patterns.json      Cross-system patterns                        │\n│  ├── commands/*.md             Loop definitions                             │\n│  └── runs/{year-month}/*.json  Archived loop runs                          │\n│                                                                             │\n│  SYSTEM ({repo}/.claude/)                                                   │\n│  ├── CLAUDE.md                 System instructions                          │\n│  ├── DREAM-STATE.md            System vision & module checklists            │\n│  ├── memory/patterns.json      System-specific patterns                     │\n│  ├── docs/                     Loop-produced documentation                  │\n│  │   ├── specs/                Specifications                               │\n│  │   ├── audits/               Security & code audits                       │\n│  │   └── reviews/              Code reviews                                 │\n│  └── modules.json              Module registry (optional)                   │\n│                                                                             │\n│  MODULE ({repo}/{path}/.claude/ or inline)                                  │\n│  ├── DREAM-STATE.md            Module function checklists                   │\n│  └── memory/patterns.json      Module-specific patterns                     │\n│                                                                             │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## MECE Document Categories\n\n### Category Taxonomy\n\nDocuments are organized into mutually exclusive categories:\n\n| Category | Scope | Purpose | Update Frequency |\n|----------|-------|---------|------------------|\n| **Instructions** | All tiers | Claude behavior rules | Rare (manual) |\n| **Dream States** | All tiers | Vision and progress | Every loop completion |\n| **Memory** | All tiers | Patterns, decisions, calibration | Every loop completion |\n| **Loop Definitions** | Organization | Workflow definitions | When loops change |\n| **Specs & Requirements** | System | Feature specifications | Per feature |\n| **Architecture** | System | Design decisions | Per major change |\n| **Audits & Reviews** | System | Quality artifacts | Per loop |\n| **Run Archives** | Organization | Historical execution data | Every loop completion |\n\n### Category Boundaries (Mutually Exclusive)\n\n```\nInstructions ≠ Dream States ≠ Memory ≠ Specs ≠ Architecture ≠ Audits\n\nRules:\n- Instructions: HOW Claude should behave\n- Dream States: WHAT \"done\" looks like + progress tracking\n- Memory: WHAT was learned (patterns, decisions, calibration)\n- Specs: WHAT to build (requirements, features)\n- Architecture: HOW to build it (design, structure)\n- Audits: HOW WELL it was built (quality, security)\n```\n\n### Collectively Exhaustive Check\n\nEvery document must belong to exactly one category:\n\n```\ndocument → categorize → one of:\n  - instructions\n  - dream-state\n  - memory\n  - spec\n  - architecture\n  - audit\n  - run-archive\n  - other (requires categorization)\n```\n\n## The Alignment Process\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                         DOCS ALIGNMENT PROCESS                               │\n│                                                                             │\n│  1. SCAN                                                                    │\n│     ├─→ Glob all documentation files across tiers                          │\n│     ├─→ Classify each file into MECE category                              │\n│     └─→ Build current state map                                            │\n│                                                                             │\n│  2. ANALYZE                                                                 │\n│     ├─→ Compare against expected state (from loop execution)               │\n│     ├─→ Identify stale documents (outdated references)                     │\n│     ├─→ Identify missing documents (gaps)                                  │\n│     └─→ Identify misplaced documents (wrong tier/category)                 │\n│                                                                             │\n│  3. PLAN                                                                    │\n│     ├─→ Generate update actions (content changes)                          │\n│     ├─→ Generate move actions (reorganization)                             │\n│     ├─→ Generate prune actions (removal)                                   │\n│     └─→ Generate create actions (new docs)                                 │\n│                                                                             │\n│  4. EXECUTE                                                                 │\n│     ├─→ Update Dream States with progress                                  │\n│     ├─→ Update cross-references                                            │\n│     ├─→ Move misplaced documents                                           │\n│     ├─→ Prune stale documents                                              │\n│     └─→ Create missing documents                                           │\n│                                                                             │\n│  5. INDEX                                                                   │\n│     ├─→ Update/create INDEX.md at each tier                                │\n│     ├─→ Ensure all documents are discoverable                              │\n│     └─→ Validate all cross-references                                      │\n│                                                                             │\n│  6. REPORT                                                                  │\n│     └─→ Generate ALIGNMENT-REPORT.md                                       │\n│                                                                             │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Step 1: Scan\n\n### File Discovery Patterns\n\n```bash\n# Organization tier\n~/.claude/CLAUDE.md\n~/.claude/DREAM-STATE.md\n~/.claude/memory/*.json\n~/.claude/commands/*.md\n~/.claude/runs/**/*.json\n\n# System tier\n{repo}/.claude/CLAUDE.md\n{repo}/.claude/DREAM-STATE.md\n{repo}/.claude/memory/*.json\n{repo}/.claude/docs/**/*.md\n{repo}/ARCHITECTURE*.md\n{repo}/CLAUDE.md\n\n# Module tier (if separate)\n{repo}/{module-path}/.claude/DREAM-STATE.md\n{repo}/{module-path}/.claude/memory/*.json\n```\n\n### Classification Rules\n\n| Pattern | Category |\n|---------|----------|\n| `CLAUDE.md` | instructions |\n| `DREAM-STATE.md` | dream-state |\n| `memory/*.json`, `patterns.json` | memory |\n| `commands/*.md`, `*-loop.md` | loop-definition |\n| `REQUIREMENTS.md`, `FEATURESPEC.md`, `SPEC*.md` | spec |\n| `ARCHITECTURE*.md`, `ADR-*.md` | architecture |\n| `*-AUDIT.md`, `CODE-REVIEW.md`, `VALIDATION.md` | audit |\n| `runs/**/*.json` | run-archive |\n\n## Step 2: Analyze\n\n### Staleness Detection\n\nA document is stale if:\n- References a completed loop that has been archived\n- Contains version numbers older than current\n- Has `last_updated` > 30 days with no recent loop touching it\n- Contains broken cross-references\n\n### Gap Detection\n\nA gap exists if:\n- Module exists in Dream State but has no function checklist\n- System has active loops but no DREAM-STATE.md\n- Loop completed but Dream State not updated\n- Run archived but Dream State \"Recent Completions\" not updated\n\n### Misplacement Detection\n\nA document is misplaced if:\n- Organization-scoped content in system directory\n- Module-specific content at system level\n- Audit files outside `docs/audits/`\n\n## Step 3: Plan\n\n### Action Types\n\n```json\n{\n  \"actions\": [\n    {\n      \"type\": \"update\",\n      \"target\": \"{repo}/.claude/DREAM-STATE.md\",\n      \"reason\": \"Loop completion — update progress\",\n      \"changes\": [\"Update module checklist\", \"Add to Recent Completions\"]\n    },\n    {\n      \"type\": \"move\",\n      \"source\": \"{repo}/SECURITY-AUDIT.md\",\n      \"target\": \"{repo}/.claude/docs/audits/SECURITY-AUDIT.md\",\n      \"reason\": \"Audit file in wrong location\"\n    },\n    {\n      \"type\": \"prune\",\n      \"target\": \"{repo}/.claude/docs/old-spec.md\",\n      \"reason\": \"Spec for completed feature, archived in run\"\n    },\n    {\n      \"type\": \"create\",\n      \"target\": \"{repo}/{module}/.claude/DREAM-STATE.md\",\n      \"reason\": \"New module needs Dream State\"\n    },\n    {\n      \"type\": \"index\",\n      \"target\": \"{repo}/.claude/INDEX.md\",\n      \"reason\": \"New documents added, index outdated\"\n    }\n  ]\n}\n```\n\n## Step 4: Execute\n\n### Update Dream States\n\nAfter each loop completion, update Dream States at all affected tiers:\n\n**Organization DREAM-STATE.md:**\n```markdown\n## Recent Completions\n| Date | System | Loop | Outcome | Summary |\n|------|--------|------|---------|---------|\n| 2025-01-29 | orchestrator | engineering-loop | success | Added docs-alignment skill |\n```\n\n**System DREAM-STATE.md:**\n```markdown\n### {module-name} (complete → in-progress)\n- [x] function_a operational\n- [x] function_b operational\n- [ ] function_c operational  ← NEW\n```\n\n### Update Cross-References\n\nWhen a document moves or is renamed:\n1. Find all files referencing old path\n2. Update references to new path\n3. Log changes in alignment report\n\n### Prune Rules\n\n| Condition | Action |\n|-----------|--------|\n| Spec for completed & shipped feature | Archive to run, remove from active |\n| Audit older than 90 days | Keep summary, archive details |\n| Duplicate documentation | Merge and remove duplicate |\n| Empty or placeholder docs | Remove if no content after 14 days |\n\n**Never prune:**\n- Dream States (update, don't delete)\n- ADRs (historical record)\n- CLAUDE.md files (instructions)\n- Memory patterns (learned knowledge)\n\n## Step 5: Index\n\n### Index Structure\n\nEach tier can have an INDEX.md:\n\n```markdown\n# Documentation Index: {tier-name}\n\n## Instructions\n- [CLAUDE.md](./CLAUDE.md) — Global behavior rules\n\n## Dream State\n- [DREAM-STATE.md](./DREAM-STATE.md) — Vision and progress\n\n## Memory\n- [patterns.json](./memory/patterns.json) — Learned patterns\n- [calibration.json](./memory/calibration.json) — Estimation calibration\n\n## Loop Definitions\n- [engineering-loop.md](./commands/engineering-loop.md) — Full engineering workflow\n- [learning-loop.md](./commands/learning-loop.md) — Pattern extraction loop\n\n## Quick Links\n- Current system: orchestrator (100% complete)\n- Active loops: learning-loop (VALIDATE phase)\n- Last completion: 2025-01-29 engineering-loop\n\n## Search Tags\n#orchestrator #mcp #skills #loops #engineering\n```\n\n### Search Optimization\n\nAdd front matter tags for discoverability:\n\n```markdown\n---\ntags: [orchestrator, mcp, skills, engineering-loop]\nlast_updated: 2025-01-29\ntier: system\ncategory: dream-state\n---\n```\n\n## Step 6: Report\n\n### Alignment Report Format\n\n```markdown\n# Documentation Alignment Report\n\n**Generated:** 2025-01-29T14:30:00Z\n**Triggered by:** engineering-loop completion\n**System:** orchestrator\n\n## Summary\n\n| Metric | Value |\n|--------|-------|\n| Documents scanned | 47 |\n| Updates applied | 8 |\n| Moves performed | 2 |\n| Documents pruned | 1 |\n| Documents created | 0 |\n| Cross-references fixed | 3 |\n\n## Actions Taken\n\n### Updates\n1. `~/.claude/DREAM-STATE.md` — Added loop completion to Recent Completions\n2. `{repo}/.claude/DREAM-STATE.md` — Updated module progress (docs-alignment 100%)\n3. ...\n\n### Moves\n1. `SECURITY-AUDIT.md` → `.claude/docs/audits/SECURITY-AUDIT.md`\n2. ...\n\n### Pruned\n1. `.claude/docs/old-draft-spec.md` — Superseded by FEATURESPEC.md\n\n### Cross-Reference Fixes\n1. `ARCHITECTURE.md` line 45: Updated link to moved audit file\n2. ...\n\n## Validation\n\n- [x] All MECE categories have documentation\n- [x] All cross-references valid\n- [x] All Dream States current\n- [x] All indexes updated\n- [x] No orphaned documents\n\n## Notes\n\n- Consider consolidating 3 similar spec files\n- Module `inbox-processor` has no recent activity (30+ days)\n```\n\n## Automatic Trigger Protocol\n\n### Hook Configuration\n\nAdd to `~/.claude/hooks.json`:\n\n```json\n{\n  \"hooks\": [\n    {\n      \"name\": \"docs-alignment-hook\",\n      \"trigger\": {\n        \"type\": \"PostPhase\",\n        \"phase\": \"COMPLETE\"\n      },\n      \"action\": {\n        \"type\": \"invoke-skill\",\n        \"skill\": \"docs-alignment\"\n      },\n      \"enabled\": true\n    }\n  ]\n}\n```\n\n### Manual Invocation\n\n```\ndocs-alignment [--tier=TIER] [--dry-run] [--verbose]\n```\n\nOptions:\n- `--tier`: Limit to specific tier (organization | system | module)\n- `--dry-run`: Show planned actions without executing\n- `--verbose`: Detailed output of all scanned files\n\n## Relationship to Other Skills\n\n| Skill | Relationship |\n|-------|--------------|\n| `retrospective` | Runs before docs-alignment; provides loop summary |\n| `document` | Creates documentation; docs-alignment organizes it |\n| `memory-manager` | Manages memory files; docs-alignment indexes them |\n| `entry-portal` | Creates Dream States; docs-alignment maintains them |\n\n## Key Principles\n\n**MECE is sacred.** Every document has exactly one home.\n\n**Dream States are living documents.** Update after every loop.\n\n**Prune aggressively, archive thoughtfully.** Don't let docs rot.\n\n**Cross-references must work.** Broken links are documentation bugs.\n\n**Indexes enable discovery.** Agents should find docs without guessing.\n\n**Automation over manual.** This skill runs automatically on completion.\n\n## References\n\n- `references/mece-categories.md`: Full MECE taxonomy with examples\n- `references/document-lifecycle.md`: Document state machine\n- `references/cross-reference-protocol.md`: How to link documents\n- `references/index-generation.md`: Index creation guidelines\n- `references/pruning-rules.md`: When and how to remove documents",
  "references": [
    {
      "name": "cross-reference-protocol.md",
      "path": "references/cross-reference-protocol.md",
      "content": "# Cross-Reference Protocol\n\n> How to link documents across tiers and categories.\n\n## Reference Types\n\n### 1. Intra-Tier References\n\nReferences within the same tier (e.g., system to system).\n\n```markdown\n# In {repo}/.claude/DREAM-STATE.md\nSee [Architecture](../ARCHITECTURE.md) for design details.\nSee [memory/patterns.json](./memory/patterns.json) for learned patterns.\n```\n\n**Use relative paths** within the same tier.\n\n### 2. Inter-Tier References\n\nReferences across tiers (e.g., system referencing organization).\n\n```markdown\n# In {repo}/.claude/DREAM-STATE.md\nThis system follows the [Organization Dream State](~/.claude/DREAM-STATE.md).\nLoop definition: [engineering-loop](~/.claude/commands/engineering-loop.md)\n```\n\n**Use absolute paths** (with `~`) for cross-tier references.\n\n### 3. External References\n\nReferences to resources outside the documentation system.\n\n```markdown\n# In {repo}/ARCHITECTURE.md\nGitHub Issue: [#123](https://github.com/org/repo/issues/123)\nAPI Docs: [OpenAPI Spec](https://api.example.com/docs)\n```\n\n**Use full URLs** for external references.\n\n## Reference Syntax\n\n### Standard Markdown Links\n\n```markdown\n[Display Text](./path/to/document.md)\n[Display Text](./path/to/document.md#section-anchor)\n```\n\n### Reference with Context\n\nWhen a reference needs explanation:\n\n```markdown\nFor implementation details, see [ARCHITECTURE.md](./ARCHITECTURE.md)\n(specifically the [Data Flow section](./ARCHITECTURE.md#data-flow)).\n```\n\n### Bidirectional References\n\nWhen two documents reference each other, ensure both links exist:\n\n```markdown\n# In DREAM-STATE.md\nModules defined in [modules.json](./modules.json).\n\n# In modules.json (as comment or separate doc)\n// Tracked in DREAM-STATE.md\n```\n\n## Reference Maintenance\n\n### On Document Creation\n\n1. Identify related documents\n2. Add forward references to new document\n3. Add backward references from related documents\n4. Update indexes\n\n### On Document Move\n\n1. Identify all documents referencing the moved file\n2. Update all references to new path\n3. Verify no broken links remain\n\n```bash\n# Find references to a file\ngrep -r \"old-path.md\" ~/.claude/ {repo}/.claude/\n\n# After move, update all references\n# (docs-alignment skill does this automatically)\n```\n\n### On Document Deletion\n\n1. Identify all documents referencing the deleted file\n2. Remove or update references\n3. Consider if references should point to archive\n\n## Reference Patterns\n\n### Dream State → Module Checklists\n\n```markdown\n# System DREAM-STATE.md\n\n## Module Checklists\n\n### skill-registry ([details](./modules/skill-registry/.claude/DREAM-STATE.md))\n- [x] list_skills operational\n- [x] get_skill operational\n```\n\n### Architecture → Decisions\n\n```markdown\n# ARCHITECTURE.md\n\n## Key Decisions\n\n| Decision | ADR | Rationale |\n|----------|-----|-----------|\n| PostgreSQL | [ADR-001](./memory/decisions/ADR-001-database.md) | ACID compliance |\n| JWT Auth | [ADR-002](./memory/decisions/ADR-002-auth.md) | Stateless scaling |\n```\n\n### Run Archive → Deliverables\n\n```markdown\n# In run archive JSON\n{\n  \"deliverables\": {\n    \"spec\": \"{repo}/FEATURESPEC.md\",\n    \"architecture\": \"{repo}/ARCHITECTURE.md\",\n    \"audit\": \"{repo}/.claude/docs/audits/2025-01-29-security.md\"\n  }\n}\n```\n\n### Loop Definition → Skills\n\n```markdown\n# engineering-loop.md\n\n## Phase Skills\n\n| Phase | Skills |\n|-------|--------|\n| INIT | [entry-portal](mcp://skills-library/entry-portal), [spec](mcp://skills-library/spec) |\n| IMPLEMENT | [implement](mcp://skills-library/implement) |\n```\n\n## Broken Reference Detection\n\n### Detection Criteria\n\nA reference is broken if:\n- Target file does not exist\n- Target section anchor does not exist\n- External URL returns 404\n- Path syntax is invalid\n\n### Repair Strategies\n\n| Scenario | Repair |\n|----------|--------|\n| File moved | Update path to new location |\n| File deleted | Remove reference or point to archive |\n| Section renamed | Update anchor |\n| External 404 | Archive.org link or remove |\n\n### Automated Detection\n\nThe docs-alignment skill scans for broken references:\n\n```\n1. Parse all markdown files for links\n2. Resolve each link path\n3. Check file existence\n4. Report broken links\n5. Suggest repairs\n```\n\n## Reference Index\n\nMaintain a reference map for fast lookup:\n\n```json\n{\n  \"references\": {\n    \"~/.claude/DREAM-STATE.md\": {\n      \"referenced_by\": [\n        \"{repo}/.claude/DREAM-STATE.md\",\n        \"~/.claude/commands/engineering-loop.md\"\n      ],\n      \"references\": [\n        \"{repo1}/.claude/DREAM-STATE.md\",\n        \"{repo2}/.claude/DREAM-STATE.md\"\n      ]\n    }\n  }\n}\n```\n\n## Best Practices\n\n### DO\n\n- Use relative paths within a tier\n- Use absolute paths across tiers\n- Include anchor links for large documents\n- Update references when moving files\n- Maintain bidirectional references for important links\n\n### DON'T\n\n- Use bare URLs without context\n- Create circular reference chains\n- Reference draft documents from active ones\n- Leave placeholder references (`TODO: add link`)\n- Create references to volatile paths\n\n## Reference Validation Checklist\n\n```markdown\n## Reference Audit\n\n- [ ] All internal links resolve to existing files\n- [ ] All section anchors exist in target documents\n- [ ] External links return 2xx status\n- [ ] Cross-tier references use absolute paths\n- [ ] Intra-tier references use relative paths\n- [ ] Bidirectional references are symmetric\n- [ ] No orphaned documents (unreferenced and not indexed)\n```\n"
    },
    {
      "name": "document-lifecycle.md",
      "path": "references/document-lifecycle.md",
      "content": "# Document Lifecycle\n\n> How documents flow through states from creation to archival.\n\n## State Machine\n\n```\n┌──────────────────────────────────────────────────────────────────────────────┐\n│                         DOCUMENT LIFECYCLE                                    │\n│                                                                              │\n│  ┌─────────┐       ┌─────────┐       ┌─────────┐       ┌─────────┐          │\n│  │ DRAFT   │──────▶│ ACTIVE  │──────▶│ STALE   │──────▶│ ARCHIVED│          │\n│  └─────────┘       └─────────┘       └─────────┘       └─────────┘          │\n│       │                 │                 │                                  │\n│       │                 │                 │                                  │\n│       │                 ▼                 ▼                                  │\n│       │           ┌─────────┐       ┌─────────┐                             │\n│       └──────────▶│ UPDATED │       │ PRUNED  │                             │\n│                   └─────────┘       └─────────┘                             │\n│                         │                                                    │\n│                         └───────────▶ (back to ACTIVE)                       │\n│                                                                              │\n└──────────────────────────────────────────────────────────────────────────────┘\n```\n\n## State Definitions\n\n### DRAFT\n\n**Description:** Document is being created, not yet ready for use.\n**Duration:** Typically within a single loop execution.\n**Triggers:** Document creation started.\n\n**Characteristics:**\n- May be incomplete\n- Not yet indexed\n- Not cross-referenced\n- May have placeholder content\n\n**Exit conditions:**\n- Loop phase completes → ACTIVE\n- Abandoned → PRUNED\n\n### ACTIVE\n\n**Description:** Document is current and in use.\n**Duration:** Until content becomes outdated or superseded.\n**Triggers:** Loop completion, manual publish.\n\n**Characteristics:**\n- Complete and accurate\n- Indexed at appropriate tier\n- Cross-referenced where relevant\n- Contains valid `last_updated` timestamp\n\n**Exit conditions:**\n- Content outdated → STALE\n- New version created → ARCHIVED\n- No longer relevant → PRUNED\n- Content changed → UPDATED → ACTIVE\n\n### UPDATED\n\n**Description:** Transient state during modification.\n**Duration:** During edit operation.\n**Triggers:** docs-alignment skill, manual edit.\n\n**Characteristics:**\n- Being modified\n- References may be temporarily broken\n- Timestamps being updated\n\n**Exit conditions:**\n- Edit complete → ACTIVE\n\n### STALE\n\n**Description:** Document content is outdated but may still have value.\n**Duration:** Until reviewed and either updated or archived.\n**Triggers:** Time threshold exceeded, references broken, superseded.\n\n**Characteristics:**\n- `last_updated` > staleness threshold (varies by category)\n- May contain outdated references\n- May reference removed features\n- Still accessible but flagged\n\n**Exit conditions:**\n- Refreshed → ACTIVE\n- No longer relevant → ARCHIVED or PRUNED\n\n### ARCHIVED\n\n**Description:** Document preserved for historical reference.\n**Duration:** Indefinite.\n**Triggers:** Superseded, loop completed, feature shipped.\n\n**Characteristics:**\n- Moved to archive location\n- Preserved in run archive\n- Not actively maintained\n- Not indexed in main index\n\n**Exit conditions:**\n- None (terminal state)\n- Exception: Revived if needed → ACTIVE\n\n### PRUNED\n\n**Description:** Document removed from the system.\n**Duration:** Permanent.\n**Triggers:** Duplicate, never completed, obsolete.\n\n**Characteristics:**\n- Deleted or moved to trash\n- Not recoverable (unless in git history)\n- Not indexed\n\n**Exit conditions:**\n- None (terminal state)\n\n## Staleness Thresholds by Category\n\n| Category | Staleness Threshold | Action |\n|----------|---------------------|--------|\n| Instructions | 90 days | Review and confirm still valid |\n| Dream States | 7 days (if active loop) | Must update after each loop |\n| Memory (patterns) | Never stale | Patterns are historical |\n| Memory (calibration) | 30 days | Review accuracy |\n| Loop Definitions | 30 days | Review for improvements |\n| Specs | 14 days (if in progress) | Review if still accurate |\n| Architecture | 30 days | Review if still accurate |\n| Audits | 7 days (if in progress) | Must complete in current loop |\n| Run Archives | Never stale | Archives are historical |\n\n## Lifecycle by Category\n\n### Instructions (CLAUDE.md)\n\n```\nDRAFT (rare) ──▶ ACTIVE ──▶ UPDATED ──▶ ACTIVE\n                                │\n                                ▼ (very rare)\n                            ARCHIVED\n```\n\nInstructions rarely go stale; they're updated in place or superseded.\n\n### Dream States\n\n```\nDRAFT ──▶ ACTIVE ◀──▶ UPDATED\n              │\n              │ (never archived, always updated)\n              ▼\n           ACTIVE\n```\n\nDream States are living documents, continuously updated.\n\n### Memory (Patterns)\n\n```\nDRAFT ──▶ ACTIVE ◀──▶ UPDATED\n              │\n              │ (patterns may be deprecated)\n              ▼\n          ARCHIVED (deprecated pattern)\n```\n\nPatterns accumulate; old ones may be deprecated but preserved.\n\n### Specs\n\n```\nDRAFT ──▶ ACTIVE ──▶ STALE ──▶ ARCHIVED\n                         │\n                         ▼\n                      PRUNED (if never completed)\n```\n\nSpecs have a clear lifecycle tied to feature delivery.\n\n### Audits\n\n```\nDRAFT ──▶ ACTIVE ──▶ ARCHIVED\n              │\n              │ (typically one per loop)\n              ▼\n           PRUNED (if duplicate)\n```\n\nAudits are loop artifacts; archived when loop completes.\n\n## Transition Triggers\n\n### DRAFT → ACTIVE\n- Loop phase completion\n- Manual \"publish\" action\n- All required sections filled\n\n### ACTIVE → UPDATED\n- docs-alignment skill runs\n- Manual edit\n- Cross-reference repair\n\n### ACTIVE → STALE\n- Time threshold exceeded\n- Referenced entity removed\n- Newer version available\n\n### STALE → ACTIVE\n- Content refreshed\n- Confirmed still accurate\n- References repaired\n\n### STALE → ARCHIVED\n- Superseded by new document\n- Feature completed and shipped\n- Loop completed\n\n### STALE → PRUNED\n- Duplicate content exists\n- Never completed draft\n- Truly obsolete\n\n### ACTIVE → ARCHIVED\n- New version created\n- Feature shipped\n- Loop completed with new run\n\n## Lifecycle Hooks\n\n### Pre-Transition Hooks\n\n| Transition | Hook | Purpose |\n|------------|------|---------|\n| * → ACTIVE | `validate-content` | Ensure document is complete |\n| * → ARCHIVED | `capture-summary` | Extract key info before archive |\n| * → PRUNED | `confirm-removal` | Verify no dependencies |\n\n### Post-Transition Hooks\n\n| Transition | Hook | Purpose |\n|------------|------|---------|\n| * → ACTIVE | `update-index` | Add to appropriate index |\n| * → ARCHIVED | `update-references` | Fix any pointing documents |\n| * → PRUNED | `remove-references` | Clean up dead links |\n\n## Document Metadata\n\nEvery document should track lifecycle state:\n\n```yaml\n---\ncategory: dream-state\ntier: system\nstate: active\ncreated_at: 2025-01-15T10:00:00Z\nlast_updated: 2025-01-29T14:30:00Z\nlast_loop: engineering-loop\nversion: 1.2.0\nsupersedes: null\nsuperseded_by: null\n---\n```\n\n## Automation Points\n\n### docs-alignment Skill Actions\n\n| State | Automatic Action |\n|-------|------------------|\n| DRAFT for >7 days | Flag for review |\n| ACTIVE with broken refs | Queue for update |\n| STALE | Check if should archive or update |\n| Multiple ACTIVE for same content | Flag duplicate |\n\n### Run Completion Actions\n\n| Event | Action |\n|-------|--------|\n| Loop completes | Archive loop deliverables to run |\n| Phase produces artifact | Update artifact state to ACTIVE |\n| Gate passed | Archive gate evidence |\n"
    },
    {
      "name": "index-generation.md",
      "path": "references/index-generation.md",
      "content": "# Index Generation\n\n> How to create and maintain documentation indexes for discoverability.\n\n## Purpose of Indexes\n\nIndexes serve as navigation hubs that:\n- Enable agents to discover relevant documentation\n- Provide quick access to frequently used docs\n- Show relationships between documents\n- Track documentation completeness\n\n## Index Types\n\n### 1. Tier Index\n\nOne index per tier summarizing all documentation at that level.\n\n**Organization Index:** `~/.claude/INDEX.md`\n```markdown\n# Organization Documentation Index\n\n## Quick Links\n- [Global Instructions](./CLAUDE.md)\n- [Organization Dream State](./DREAM-STATE.md)\n\n## Systems\n| System | Status | Dream State |\n|--------|--------|-------------|\n| orchestrator | active | [link]({repo}/.claude/DREAM-STATE.md) |\n| dashboard | active | [link]({repo2}/.claude/DREAM-STATE.md) |\n\n## Loop Definitions\n- [engineering-loop](./commands/engineering-loop.md) — Full engineering workflow\n- [learning-loop](./commands/learning-loop.md) — Pattern extraction\n- ...\n\n## Memory\n- [Patterns](./memory/patterns.json) — Organization-wide patterns\n- [Calibration](./memory/calibration.json) — Global estimation calibration\n\n## Recent Activity\n| Date | System | Loop | Outcome |\n|------|--------|------|---------|\n| 2025-01-29 | orchestrator | engineering-loop | success |\n```\n\n**System Index:** `{repo}/.claude/INDEX.md`\n```markdown\n# System Documentation Index: orchestrator\n\n## Quick Links\n- [Project Instructions](./CLAUDE.md)\n- [System Dream State](./DREAM-STATE.md)\n- [Architecture](../ARCHITECTURE.md)\n\n## Modules\n| Module | Status | Path |\n|--------|--------|------|\n| skill-registry | complete | src/services/SkillRegistry.ts |\n| execution-engine | complete | src/services/ExecutionEngine.ts |\n\n## Documentation by Category\n\n### Specifications\n- [Requirements](../REQUIREMENTS.md)\n- [Feature Spec](../FEATURESPEC.md)\n\n### Architecture\n- [Architecture Overview](../ARCHITECTURE.md)\n- [ADR-001: Hierarchy](./memory/decisions/ADR-001.md)\n\n### Audits\n- [Security Audit](./docs/audits/SECURITY-AUDIT.md)\n- [Code Review](./docs/reviews/CODE-REVIEW.md)\n\n## Memory\n- [Patterns](./memory/patterns.json)\n- [Decisions](./memory/decisions/)\n```\n\n### 2. Category Index\n\nIndex for a specific document category.\n\n```markdown\n# Architecture Decision Records\n\n| ADR | Title | Status | Date |\n|-----|-------|--------|------|\n| [ADR-001](./ADR-001-database.md) | Database Selection | Accepted | 2025-01-15 |\n| [ADR-002](./ADR-002-auth.md) | Authentication | Accepted | 2025-01-18 |\n| [ADR-003](./ADR-003-api.md) | API Design | Proposed | 2025-01-29 |\n\n## Status Legend\n- **Proposed**: Under discussion\n- **Accepted**: In use\n- **Deprecated**: No longer applies\n- **Superseded**: Replaced by another ADR\n```\n\n### 3. Search Index\n\nMachine-readable index for agent discovery.\n\n```json\n{\n  \"index_version\": \"1.0.0\",\n  \"generated_at\": \"2025-01-29T14:30:00Z\",\n  \"tier\": \"system\",\n  \"system\": \"orchestrator\",\n  \"documents\": [\n    {\n      \"path\": \".claude/DREAM-STATE.md\",\n      \"category\": \"dream-state\",\n      \"title\": \"System Dream State: orchestrator\",\n      \"tags\": [\"vision\", \"progress\", \"modules\"],\n      \"last_updated\": \"2025-01-29T14:30:00Z\"\n    },\n    {\n      \"path\": \"ARCHITECTURE.md\",\n      \"category\": \"architecture\",\n      \"title\": \"Orchestrator Architecture\",\n      \"tags\": [\"design\", \"components\", \"mcp\"],\n      \"last_updated\": \"2025-01-28T10:00:00Z\"\n    }\n  ],\n  \"quick_access\": {\n    \"dream_state\": \".claude/DREAM-STATE.md\",\n    \"instructions\": \"CLAUDE.md\",\n    \"architecture\": \"ARCHITECTURE.md\"\n  }\n}\n```\n\n## Index Structure\n\n### Header Section\n\n```markdown\n# [Scope] Documentation Index\n\n> Generated: 2025-01-29 | Last updated: 2025-01-29\n\n## Overview\nBrief description of what this index covers.\n```\n\n### Navigation Section\n\n```markdown\n## Quick Links\nMost frequently accessed documents.\n\n## By Category\nDocuments organized by MECE category.\n\n## By Status\nDocuments organized by lifecycle state.\n```\n\n### Content Section\n\n```markdown\n## [Category Name]\n\n| Document | Purpose | Last Updated |\n|----------|---------|--------------|\n| [Name](./path) | Brief description | 2025-01-29 |\n```\n\n### Footer Section\n\n```markdown\n---\n\n## Index Maintenance\n- Auto-generated by docs-alignment skill\n- Manual updates: edit INDEX.md directly\n- Regenerate: run `docs-alignment --index-only`\n\n## Search Tags\n#orchestrator #mcp #skills #engineering\n```\n\n## Generation Algorithm\n\n```\n1. SCAN all files matching documentation patterns\n2. CLASSIFY each file by category and tier\n3. EXTRACT metadata (title, tags, dates)\n4. GROUP by category\n5. SORT within groups (by name or date)\n6. GENERATE markdown index\n7. GENERATE JSON search index\n8. WRITE to index files\n```\n\n### Metadata Extraction\n\nFrom YAML frontmatter:\n```yaml\n---\ntitle: Document Title\ntags: [tag1, tag2]\ncategory: architecture\nlast_updated: 2025-01-29\n---\n```\n\nFrom content if no frontmatter:\n- Title: First `# heading`\n- Tags: Inferred from content keywords\n- Category: Inferred from filename/location\n- Last updated: File modification time\n\n## Index Maintenance\n\n### Triggers for Regeneration\n\n| Event | Action |\n|-------|--------|\n| Loop completion | Full index regeneration |\n| Document created | Add to relevant indexes |\n| Document moved | Update paths in indexes |\n| Document deleted | Remove from indexes |\n| Manual request | Targeted or full regeneration |\n\n### Incremental Updates\n\nFor efficiency, track changes:\n\n```json\n{\n  \"index_state\": {\n    \"last_full_scan\": \"2025-01-29T10:00:00Z\",\n    \"documents_hash\": \"abc123\",\n    \"pending_updates\": [\n      { \"action\": \"add\", \"path\": \"new-doc.md\" },\n      { \"action\": \"remove\", \"path\": \"deleted-doc.md\" }\n    ]\n  }\n}\n```\n\n### Consistency Checks\n\n```markdown\n## Index Validation\n\n- [ ] All indexed documents exist\n- [ ] All documents in scope are indexed\n- [ ] All links in index are valid\n- [ ] Categories match document content\n- [ ] Dates are current\n```\n\n## Agent Discovery Protocol\n\nWhen an agent needs documentation:\n\n```\n1. Load INDEX.md at current tier\n2. Search quick_access for common needs\n3. If not found, search by category\n4. If not found, check parent tier index\n5. If not found, use search index JSON\n```\n\n### Search Patterns\n\n```bash\n# Find documents about authentication\ngrep -l \"auth\" ~/.claude/INDEX.md {repo}/.claude/INDEX.md\n\n# Find all architecture documents\njq '.documents[] | select(.category == \"architecture\")' .claude/search-index.json\n\n# Find recently updated\njq '.documents | sort_by(.last_updated) | reverse | .[0:5]' .claude/search-index.json\n```\n\n## Best Practices\n\n### DO\n- Keep indexes at the root of each tier\n- Include last_updated timestamps\n- Group by MECE categories\n- Provide quick links for common access\n- Generate both human (MD) and machine (JSON) formats\n\n### DON'T\n- Index draft documents\n- Include full document content in index\n- Create deeply nested index hierarchies\n- Manually maintain what can be auto-generated\n- Index external or transient files\n\n## Index Templates\n\n### Minimal Index\n\n```markdown\n# Documentation Index\n\n- [Instructions](./CLAUDE.md)\n- [Dream State](./DREAM-STATE.md)\n- [Architecture](./ARCHITECTURE.md)\n```\n\n### Full Index\n\nSee examples above for complete tier and category indexes.\n"
    },
    {
      "name": "mece-categories.md",
      "path": "references/mece-categories.md",
      "content": "# MECE Documentation Categories\n\n> Mutually Exclusive, Collectively Exhaustive taxonomy for all documentation.\n\n## The MECE Principle\n\n**Mutually Exclusive:** No document belongs to multiple categories.\n**Collectively Exhaustive:** Every document belongs to exactly one category.\n\n## Category Definitions\n\n### 1. Instructions\n\n**Scope:** How Claude should behave\n**Files:** `CLAUDE.md` at any tier\n**Location:** Root of tier directory\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| Organization | `~/.claude/CLAUDE.md` | Global instructions for all projects |\n| System | `{repo}/CLAUDE.md` or `{repo}/.claude/CLAUDE.md` | Project-specific instructions |\n| Module | `{repo}/{module}/.claude/CLAUDE.md` | Module-specific instructions (rare) |\n\n**Includes:**\n- Behavior rules\n- Workflow defaults\n- Tool preferences\n- Anti-patterns to avoid\n\n**Does NOT include:**\n- Progress tracking (→ Dream State)\n- Learned patterns (→ Memory)\n- Feature requirements (→ Spec)\n\n### 2. Dream States\n\n**Scope:** What \"done\" looks like + current progress\n**Files:** `DREAM-STATE.md` at any tier\n**Location:** `.claude/` directory at each tier\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| Organization | `~/.claude/DREAM-STATE.md` | Org-wide vision, system list, master checklist |\n| System | `{repo}/.claude/DREAM-STATE.md` | System vision, module list, module checklists |\n| Module | `{repo}/{module}/.claude/DREAM-STATE.md` | Function checklists, dependencies |\n\n**Includes:**\n- Vision statements\n- Progress checklists\n- Module/function completion status\n- Recent completions\n- Active loops\n\n**Does NOT include:**\n- How to build it (→ Architecture)\n- What to build (→ Spec)\n- How Claude should behave (→ Instructions)\n\n### 3. Memory\n\n**Scope:** Learned knowledge from execution\n**Files:** `patterns.json`, `calibration.json`, `decisions/*.md`\n**Location:** `memory/` subdirectory at each tier\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| Organization | `~/.claude/memory/` | Cross-system patterns, global calibration |\n| System | `{repo}/.claude/memory/` | System-specific patterns, decisions |\n| Module | `{repo}/{module}/.claude/memory/` | Module-specific learnings |\n\n**Includes:**\n- Patterns (reusable solutions)\n- Decisions (ADRs)\n- Calibration data (estimation accuracy)\n- Handoffs (session context)\n\n**Does NOT include:**\n- Current progress (→ Dream State)\n- Feature requirements (→ Spec)\n- Design diagrams (→ Architecture)\n\n### 4. Loop Definitions\n\n**Scope:** Workflow process definitions\n**Files:** `*-loop.md`, `loop.json`\n**Location:** `commands/` at organization tier\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| Organization | `~/.claude/commands/*.md` | Loop command definitions |\n| System | N/A | Loops are defined at org level only |\n\n**Includes:**\n- Phase definitions\n- Gate configurations\n- Skill assignments\n- State schemas\n\n**Does NOT include:**\n- Execution state (→ Run Archives)\n- Skills themselves (→ separate skills directory)\n\n### 5. Specs & Requirements\n\n**Scope:** What to build\n**Files:** `REQUIREMENTS.md`, `FEATURESPEC.md`, `SPEC*.md`\n**Location:** System root or `.claude/docs/specs/`\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| System | `{repo}/REQUIREMENTS.md` | High-level requirements |\n| System | `{repo}/FEATURESPEC.md` | Detailed feature specification |\n| System | `{repo}/.claude/docs/specs/*.md` | Archived or supplementary specs |\n\n**Includes:**\n- User stories\n- Acceptance criteria\n- Feature specifications\n- API contracts (what, not how)\n\n**Does NOT include:**\n- Design decisions (→ Architecture)\n- Progress tracking (→ Dream State)\n- Quality results (→ Audit)\n\n### 6. Architecture\n\n**Scope:** How to build it\n**Files:** `ARCHITECTURE.md`, `ADR-*.md`, design docs\n**Location:** System root or `.claude/docs/` or `memory/decisions/`\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| System | `{repo}/ARCHITECTURE.md` | System architecture overview |\n| System | `{repo}/.claude/memory/decisions/` | Architectural Decision Records |\n| System | `{repo}/.claude/docs/architecture/` | Design documents |\n\n**Includes:**\n- System diagrams\n- Component relationships\n- Technology choices\n- Design decisions (ADRs)\n- Trade-off analysis\n\n**Does NOT include:**\n- What to build (→ Spec)\n- Quality validation (→ Audit)\n- Current progress (→ Dream State)\n\n### 7. Audits & Reviews\n\n**Scope:** Quality and security artifacts\n**Files:** `*-AUDIT.md`, `CODE-REVIEW.md`, `VALIDATION.md`, `VERIFICATION.md`\n**Location:** System root (active) or `.claude/docs/audits/` (archived)\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| System | `{repo}/SECURITY-AUDIT.md` | Active security audit |\n| System | `{repo}/CODE-REVIEW.md` | Active code review |\n| System | `{repo}/.claude/docs/audits/` | Archived audit artifacts |\n| System | `{repo}/.claude/docs/reviews/` | Archived review artifacts |\n\n**Includes:**\n- Security audit results\n- Code review findings\n- Validation reports\n- Verification results\n- Performance analysis\n\n**Does NOT include:**\n- How to build (→ Architecture)\n- What to build (→ Spec)\n- Progress tracking (→ Dream State)\n\n### 8. Run Archives\n\n**Scope:** Historical loop execution data\n**Files:** `{system}-{loop}-{timestamp}.json`\n**Location:** `~/.claude/runs/{year-month}/`\n\n| Tier | Path | Purpose |\n|------|------|---------|\n| Organization | `~/.claude/runs/` | All archived loop runs |\n\n**Includes:**\n- Loop state at completion\n- Phase summaries\n- Gate results\n- Deliverable references\n- Timing data\n\n**Does NOT include:**\n- Active loop state (→ working directory)\n- Pattern extraction (→ Memory)\n\n## Classification Decision Tree\n\n```\nIs it about HOW Claude should behave?\n  └─ YES → Instructions (CLAUDE.md)\n  └─ NO ↓\n\nIs it about WHAT \"done\" looks like or current progress?\n  └─ YES → Dream State\n  └─ NO ↓\n\nIs it learned knowledge (patterns, decisions, calibration)?\n  └─ YES → Memory\n  └─ NO ↓\n\nIs it a workflow/loop definition?\n  └─ YES → Loop Definition\n  └─ NO ↓\n\nIs it about WHAT to build (requirements, features)?\n  └─ YES → Spec\n  └─ NO ↓\n\nIs it about HOW to build (design, architecture)?\n  └─ YES → Architecture\n  └─ NO ↓\n\nIs it about quality (audits, reviews, validation)?\n  └─ YES → Audit\n  └─ NO ↓\n\nIs it historical execution data?\n  └─ YES → Run Archive\n  └─ NO → Uncategorized (needs categorization!)\n```\n\n## Common Misclassifications\n\n| Document | Wrong Category | Correct Category | Why |\n|----------|---------------|------------------|-----|\n| Progress checklist | Instructions | Dream State | Progress ≠ behavior rules |\n| Pattern learned | Dream State | Memory | Patterns are learned, not progress |\n| API contract | Architecture | Spec | Contract is what, not how |\n| ADR | Spec | Architecture | Decisions are design, not requirements |\n| Code review | Spec | Audit | Review is quality, not requirements |\n\n## Tier Boundaries\n\n### Organization Tier Only\n- Loop definitions (`commands/*.md`)\n- Run archives (`runs/`)\n- Cross-system patterns\n\n### System Tier Only\n- Specs and requirements\n- Architecture documents\n- Audits and reviews\n- System-specific patterns\n\n### Module Tier (Optional)\n- Module Dream State\n- Module-specific patterns\n- Module-specific instructions (rare)\n\n## Validation Rules\n\n1. **No duplicates:** Same content should not exist in multiple categories\n2. **No hybrids:** A document should not mix categories (split if needed)\n3. **Complete coverage:** Every documentation file must have a category\n4. **Tier appropriate:** Documents live at the correct tier for their scope\n"
    },
    {
      "name": "pruning-rules.md",
      "path": "references/pruning-rules.md",
      "content": "# Pruning Rules\n\n> When and how to remove or archive documentation.\n\n## Pruning vs. Archiving\n\n| Action | Outcome | Reversibility | When to Use |\n|--------|---------|---------------|-------------|\n| **Prune** | Delete permanently | Git history only | Duplicates, abandoned drafts |\n| **Archive** | Move to archive location | Easily reversible | Completed work, superseded docs |\n\n## Never Prune\n\nThese documents should NEVER be deleted:\n\n| Category | Reason |\n|----------|--------|\n| `CLAUDE.md` (any tier) | Instructions are configuration |\n| `DREAM-STATE.md` (any tier) | Vision documents are living |\n| `ADR-*.md` | Architectural decisions are historical record |\n| `patterns.json` | Learned patterns have value |\n| Run archives | Historical execution data |\n| Memory decisions | ADRs and decisions |\n\n**Exception:** May prune if truly duplicated (exact copy exists elsewhere).\n\n## Prune Candidates\n\n### 1. Abandoned Drafts\n\n**Criteria:**\n- Document has `state: draft` or no content\n- Older than 14 days\n- Not referenced by any active document\n- Not associated with an active loop\n\n**Action:** Delete after confirmation.\n\n### 2. Duplicates\n\n**Criteria:**\n- Content is 90%+ identical to another document\n- Both documents have same purpose\n- One is clearly the \"canonical\" version\n\n**Action:**\n1. Merge any unique content to canonical version\n2. Update references to point to canonical\n3. Delete duplicate\n\n### 3. Superseded Specs\n\n**Criteria:**\n- Feature has shipped\n- Spec content is captured in run archive\n- No ongoing reference need\n\n**Action:** Archive to `docs/specs/archived/` or delete if in run archive.\n\n### 4. Stale Audits\n\n**Criteria:**\n- Audit is for a completed loop\n- Results captured in run archive\n- Older than 90 days\n\n**Action:** Archive to `docs/audits/archived/` with date prefix.\n\n### 5. Placeholder Documents\n\n**Criteria:**\n- Contains only \"TODO\" or placeholder text\n- Created > 7 days ago\n- No actual content added\n\n**Action:** Delete.\n\n## Prune Decision Tree\n\n```\nIs this a protected document type?\n  └─ YES → DO NOT PRUNE\n  └─ NO ↓\n\nIs this an exact duplicate?\n  └─ YES → Merge unique content, then PRUNE duplicate\n  └─ NO ↓\n\nIs this a draft older than 14 days with no content?\n  └─ YES → PRUNE (abandoned)\n  └─ NO ↓\n\nIs this content captured elsewhere (run archive)?\n  └─ YES → ARCHIVE (not prune)\n  └─ NO ↓\n\nDoes any document reference this?\n  └─ YES → Update references first, then decide\n  └─ NO ↓\n\nIs this actively used?\n  └─ YES → DO NOT PRUNE\n  └─ NO → Consider ARCHIVE or PRUNE based on age\n```\n\n## Archive Rules\n\n### When to Archive\n\n| Document Type | Archive Trigger | Archive Location |\n|---------------|-----------------|------------------|\n| Loop deliverables | Loop completes | Run archive JSON |\n| Feature specs | Feature ships | `docs/specs/archived/` |\n| Audits | Loop completes | `docs/audits/archived/` |\n| Old Dream State | Major vision change | Append `.bak` with date |\n\n### Archive Naming Convention\n\n```\n{original-name}-{date}.{ext}\n\nExamples:\n- FEATURESPEC-2025-01-15.md\n- SECURITY-AUDIT-2025-01-29.md\n- ARCHITECTURE-v1-2025-01-01.md\n```\n\n### Archive Location Hierarchy\n\n```\n{repo}/.claude/docs/\n├── specs/\n│   ├── FEATURESPEC.md          ← Active\n│   └── archived/\n│       └── FEATURESPEC-2025-01.md\n├── audits/\n│   ├── SECURITY-AUDIT.md       ← Active\n│   └── archived/\n│       └── SECURITY-AUDIT-2025-01.md\n└── reviews/\n    └── archived/\n        └── CODE-REVIEW-2025-01.md\n```\n\n## Pruning Process\n\n### 1. Identify Candidates\n\n```bash\n# Find old drafts\nfind {repo}/.claude -name \"*.md\" -mtime +14 -exec grep -l \"TODO\\|DRAFT\" {} \\;\n\n# Find potential duplicates (by size similarity)\n# Manual review required\n\n# Find unreferenced documents\n# Cross-reference with index and grep for links\n```\n\n### 2. Verify Safety\n\nBefore pruning, check:\n\n```markdown\n## Prune Safety Checklist\n\n- [ ] Not a protected document type\n- [ ] Not referenced by any active document\n- [ ] Not associated with an active loop\n- [ ] Content is captured elsewhere (if valuable)\n- [ ] No unique information that would be lost\n```\n\n### 3. Execute Prune\n\n```bash\n# For archival\nmv {source} {repo}/.claude/docs/{category}/archived/{name}-{date}.md\n\n# For deletion (ensure git tracks)\ngit rm {file}\ngit commit -m \"prune: remove {reason}\"\n```\n\n### 4. Clean Up References\n\nAfter pruning:\n- Update any documents that referenced pruned file\n- Update indexes to remove entry\n- Log in alignment report\n\n## Batch Pruning\n\nFor periodic maintenance:\n\n```markdown\n## Batch Prune Report\n\n### Candidates Identified\n| File | Reason | Age | Action |\n|------|--------|-----|--------|\n| old-spec.md | Superseded | 45 days | Archive |\n| draft-2.md | Abandoned | 21 days | Prune |\n| duplicate.md | Duplicate of X | 10 days | Prune |\n\n### Actions Taken\n- Archived: 3 documents\n- Pruned: 2 documents\n- Skipped: 1 document (referenced)\n\n### References Updated\n- DREAM-STATE.md line 45\n- INDEX.md (removed 2 entries)\n```\n\n## Retention Policies\n\n### By Category\n\n| Category | Active Retention | Archive Retention |\n|----------|------------------|-------------------|\n| Instructions | Forever | Forever |\n| Dream States | Forever | Forever |\n| Memory | Forever | Forever |\n| Loop Definitions | Forever | Forever |\n| Specs | Until shipped | 1 year |\n| Architecture | Until superseded | Forever (as ADR) |\n| Audits | Until loop complete | 90 days |\n| Run Archives | Forever | Forever |\n\n### By Age\n\n| Age | Review Action |\n|-----|---------------|\n| 0-7 days | No action (too new) |\n| 7-14 days | Check for abandoned drafts |\n| 14-30 days | Check for stale content |\n| 30-90 days | Consider archival |\n| 90+ days | Must justify keeping active |\n\n## Automation Integration\n\nThe docs-alignment skill automates pruning detection:\n\n```json\n{\n  \"prune_candidates\": [\n    {\n      \"path\": \"docs/old-spec.md\",\n      \"reason\": \"superseded\",\n      \"age_days\": 45,\n      \"recommended_action\": \"archive\",\n      \"references\": []\n    }\n  ],\n  \"auto_prune_enabled\": false,\n  \"require_confirmation\": true\n}\n```\n\n**Note:** Auto-pruning is disabled by default. All prune actions require confirmation.\n"
    }
  ],
  "tags": [
    "meta",
    "documentation",
    "alignment",
    "mece",
    "hierarchy",
    "completion-protocol"
  ],
  "dependsOn": [
    "retrospective"
  ]
}