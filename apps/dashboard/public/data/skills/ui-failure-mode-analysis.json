{
  "id": "ui-failure-mode-analysis",
  "name": "ui-failure-mode-analysis",
  "version": "1.0.0",
  "description": "Apply MECE failure mode taxonomy to UI pipelines with L5/L6 extensions. Identifies UI-specific failure patterns like Dead Click, Stale Closure, State Desync. Produces UI-FAILURE-MODES.md with coverage calculation.",
  "phase": "REVIEW",
  "category": "core",
  "content": "# UI Failure Mode Analysis\n\nApply MECE failure mode taxonomy to UI pipelines.\n\n## When to Use\n\n- **After UI pipeline discovery** — Runs in REVIEW phase on identified U-series\n- **UI-specific failure identification** — Find ways UI interactions can fail\n- **Coverage assessment** — Calculate what percentage of UI failures are validated\n- When you say: \"analyze UI failures\", \"what can break in the UI?\", \"find interaction bugs\"\n\n## Reference Requirements\n\n**MUST read before applying this skill:**\n\n| Reference | Why Required |\n|-----------|--------------|\n| `ui-failure-patterns.md` | The 8 UI-specific failure patterns |\n| `l5-l6-locations.md` | Interaction and Streaming location codes |\n\n**Read if applicable:**\n\n| Reference | When Needed |\n|-----------|-------------|\n| `ui-failure-template.md` | How to document UI failure modes |\n\n**Verification:** Every UI pipeline step analyzed for failure modes including L5/L6.\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| `UI-FAILURE-MODES.md` | Project root | Always |\n| Coverage update | `audit-state.json` | Always (ui coverage) |\n\n## Core Concept\n\nUI Failure Mode Analysis answers: **\"What are all the ways UI interactions can fail?\"**\n\nUI failures are different from backend failures:\n- Users experience them directly\n- They involve state, callbacks, and visual feedback\n- They include interaction timing and streaming\n- They affect perceived quality even when \"working\"\n\n## Extended Location Codes (L5/L6)\n\nUI pipelines need additional location codes:\n\n| Code | Location | Description | Examples |\n|------|----------|-------------|----------|\n| L5 | **Interaction** | Tool execution, callbacks, user action handling | Dead click, stale closure |\n| L6 | **Streaming** | SSE parsing, incremental updates, real-time sync | Stream disconnect, partial render |\n\nCombined with L1-L4 from backend analysis:\n- L1-Input: User input handling\n- L2-Processing: Client-side logic\n- L3-Output: Rendering, display\n- L4-Integration: Context sync, API calls\n\n## UI-Specific Failure Patterns\n\n| Pattern | Code | Description | User Experience |\n|---------|------|-------------|-----------------|\n| **Dead Click** | L5-T2 | Button/action produces no response | \"Is it broken?\" |\n| **Stale Closure** | L5-T1 | Callback uses outdated state | Wrong item affected |\n| **State Desync** | L3-T1 | UI shows stale data | Confusion, lost work |\n| **Missing Feedback** | L3-T5 | No loading/error indicator | Uncertainty |\n| **Context Loss** | L4-T1 | Navigation loses selection | Frustration, re-work |\n| **Race Condition** | L5-T2 | Fast clicks cause wrong state | Duplicates, wrong order |\n| **Stream Disconnect** | L6-T3 | SSE connection drops | Partial content |\n| **Callback Leak** | L5-T3 | Unregistered callbacks accumulate | Slowdown, memory |\n\n## Analysis Process\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│            UI FAILURE MODE ANALYSIS PROCESS                 │\n│                                                             │\n│  FOR EACH UI PIPELINE:                                      │\n│                                                             │\n│  1. WALK THROUGH EACH STEP                                  │\n│     └─→ What can go wrong at this interaction point?       │\n│                                                             │\n│  2. CHECK EACH PATTERN                                      │\n│     └─→ Could Dead Click occur here? Stale Closure? etc.   │\n│                                                             │\n│  3. FOR EACH POTENTIAL FAILURE                              │\n│     ├─→ Assign Location (L1-L6)                            │\n│     ├─→ Assign Type (T1-T5)                                │\n│     ├─→ Assign Severity (S1-S4)                            │\n│     ├─→ Identify pattern if applicable                     │\n│     └─→ Generate ID: U{N}-{NNN}                            │\n│                                                             │\n│  4. CHECK VALIDATION STATUS                                 │\n│     ├─→ Is there explicit handling?                        │\n│     ├─→ Is there test coverage?                            │\n│     └─→ Mark VALIDATED or UNVALIDATED                      │\n│                                                             │\n│  5. CALCULATE COVERAGE                                      │\n│     └─→ (Validated / Total) × 100%                         │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## UI Failure Mode Documentation\n\n```markdown\n### U1-005: Cache not invalidated after edit\n\n| Attribute | Value |\n|-----------|-------|\n| **ID** | U1-005 |\n| **Pipeline** | U1: Chat-to-Edit |\n| **Step** | 9. React Query cache invalidation |\n| **Location** | L3-Output |\n| **Type** | T1-Data |\n| **Severity** | S1-Silent |\n| **Pattern** | State Desync |\n| **Description** | Edit succeeds but cache not invalidated |\n| **Impact** | User sees stale artifact until manual refresh |\n| **Detection** | None (silent) |\n| **Status** | UNVALIDATED |\n| **Test Spec** | TEST-U1-005 |\n| **Fix** | Add queryClient.invalidateQueries(['artifact', id]) |\n| **Effort** | S |\n```\n\n## Output Format\n\n### UI-FAILURE-MODES.md\n\n```markdown\n# UI Failure Modes\n\n## Summary\n\n| Pipeline | Failure Modes | Validated | Coverage |\n|----------|---------------|-----------|----------|\n| U1: Chat-to-Edit | 8 | 2 | 25% |\n| U2: Chat-to-Generate | 10 | 3 | 30% |\n| U3: Selection-to-Context | 5 | 2 | 40% |\n| **Total** | **23** | **7** | **30%** |\n\n## Pattern Distribution\n\n| Pattern | Count | Description |\n|---------|-------|-------------|\n| Dead Click | 3 | Actions with no response |\n| Stale Closure | 2 | Callbacks using old state |\n| State Desync | 5 | UI showing stale data |\n| Missing Feedback | 4 | No loading/error states |\n| Stream Disconnect | 3 | SSE connection issues |\n| Other | 6 | Various |\n\n## Location Distribution\n\n| Location | Count | Note |\n|----------|-------|------|\n| L5-Interaction | 8 | UI-specific |\n| L6-Streaming | 5 | UI-specific |\n| L3-Output | 6 | Rendering issues |\n| L4-Integration | 4 | Context sync |\n\n## U1: Chat-to-Edit\n\n### U1-001: artifact_id not in context\n\n| Attribute | Value |\n|-----------|-------|\n| **Location** | L5-Interaction |\n| **Type** | T1-Data |\n| **Severity** | S4-Blocking |\n| **Pattern** | Context Loss |\n| **Description** | User tries to edit but context.artifact_id is null |\n| **Status** | UNVALIDATED |\n\n[... more failure modes ...]\n```\n\n## Priority Order for UI Fixes\n\n1. **S1 (Silent) + L5/L6** — Invisible interaction bugs\n2. **S4 (Blocking)** — User completely stuck\n3. **State Desync** — Confusing, loses trust\n4. **Missing Feedback** — Anxiety, repeated clicks\n5. **Stream issues** — Partial content\n\n## Validation Checklist\n\n- [ ] Every UI pipeline step analyzed\n- [ ] All 8 UI patterns checked for each step\n- [ ] L5/L6 locations used appropriately\n- [ ] Each failure mode has pattern identified (if applicable)\n- [ ] Unique ID assigned (U{N}-{NNN})\n- [ ] Validation status checked\n- [ ] Coverage percentages calculated",
  "references": [
    {
      "name": "l5-l6-locations.md",
      "path": "references/l5-l6-locations.md",
      "content": "# L5 and L6 Location Codes\n\nExtended location codes for UI-specific failures.\n\n## L5: Interaction\n\nFailures in user action handling, tool execution, and callbacks.\n\n### What It Covers\n\n- Button click handlers\n- Form submissions\n- Keyboard shortcuts\n- Drag and drop handlers\n- Tool call execution\n- Callback registration and invocation\n- Event listener behavior\n\n### Examples\n\n| Failure | Code | Description |\n|---------|------|-------------|\n| Dead Click | L5-T2 | Handler doesn't respond |\n| Stale Closure | L5-T1 | Callback uses old data |\n| Race Condition | L5-T2 | Rapid clicks cause issues |\n| Callback Leak | L5-T3 | Listeners accumulate |\n| Tool Failure | L5-T2 | Tool handler throws |\n\n### Code Patterns\n\n```typescript\n// L5 failures occur in interaction code\nonClick={() => {\n  // L5-T2: Handler error\n}}\n\nconst callback = useCallback(() => {\n  doSomething(value);  // L5-T1: Stale value\n}, []);\n\nuseEffect(() => {\n  element.addEventListener('click', handler);\n  // L5-T3: No cleanup\n}, []);\n```\n\n## L6: Streaming\n\nFailures in SSE parsing, incremental updates, and real-time synchronization.\n\n### What It Covers\n\n- Server-Sent Events (SSE)\n- WebSocket connections\n- Streaming response parsing\n- Incremental rendering\n- Real-time subscriptions\n- Live updates\n\n### Examples\n\n| Failure | Code | Description |\n|---------|------|-------------|\n| Stream Disconnect | L6-T3 | Connection dropped |\n| Parse Error | L6-T1 | Malformed chunk |\n| Partial Render | L6-T2 | Incomplete display |\n| Buffer Overflow | L6-T3 | Too much data |\n| Sync Lost | L6-T1 | Missed updates |\n\n### Code Patterns\n\n```typescript\n// L6 failures occur in streaming code\nconst es = new EventSource('/api/stream');\nes.onmessage = (event) => {\n  const data = JSON.parse(event.data);  // L6-T1: Parse error\n  appendContent(data.chunk);  // L6-T2: Render error\n};\nes.onerror = () => {\n  // L6-T3: Connection error\n};\n\n// Supabase channels\nsupabase.channel('updates')\n  .on('*', (payload) => {\n    updateState(payload);  // L6-T1: Missing update\n  });\n```\n\n## When to Use L5 vs L6\n\n| Scenario | Location |\n|----------|----------|\n| Button click fails | L5 |\n| Form submit fails | L5 |\n| Tool call fails | L5 |\n| SSE stream drops | L6 |\n| WebSocket message lost | L6 |\n| Real-time update missed | L6 |\n| Callback memory leak | L5 |\n| Streaming response partial | L6 |\n\n## Combined with L1-L4\n\nUI pipelines also use standard locations:\n\n| Code | UI Context |\n|------|------------|\n| L1-Input | User input validation, form field errors |\n| L2-Processing | Client-side computation, parsing |\n| L3-Output | Rendering, display, visual feedback |\n| L4-Integration | Context sync, API calls, state handoff |\n| L5-Interaction | User action handling, callbacks |\n| L6-Streaming | Real-time updates, SSE, WebSocket |\n\n## Distribution Expectations\n\nTypical UI failure distribution:\n\n```\nL5-Interaction: 30-40%  (interaction bugs common)\nL6-Streaming:   10-20%  (if app uses streaming)\nL3-Output:      25-35%  (rendering/feedback issues)\nL4-Integration: 15-25%  (context sync issues)\nL1-Input:        5-10%  (input validation)\nL2-Processing:   5-10%  (client logic)\n```\n"
    },
    {
      "name": "ui-failure-patterns.md",
      "path": "references/ui-failure-patterns.md",
      "content": "# UI Failure Patterns\n\nThe 8 common UI failure patterns to check for.\n\n## 1. Dead Click\n\n**Code:** L5-T2\n**Description:** User action produces no visible response.\n\n**Causes:**\n- Event handler not attached\n- Handler throws but error swallowed\n- Async operation with no feedback\n- Disabled state not visible\n\n**Detection:**\n```typescript\n// Look for handlers that might fail silently\nonClick={async () => {\n  await doSomething();  // If this fails, nothing happens\n}}\n```\n\n**User experience:** \"Did I click it? Is it broken?\"\n\n## 2. Stale Closure\n\n**Code:** L5-T1\n**Description:** Callback captures outdated state value.\n\n**Causes:**\n- useCallback without proper deps\n- Event listener not updated\n- Interval/timeout using old value\n\n**Detection:**\n```typescript\n// Look for closures that might be stale\nconst handleEdit = useCallback(() => {\n  editArtifact(artifactId);  // artifactId might be old\n}, []);  // Missing artifactId in deps!\n```\n\n**User experience:** Wrong item affected, mysterious behavior.\n\n## 3. State Desync\n\n**Code:** L3-T1\n**Description:** UI displays data that doesn't match backend.\n\n**Causes:**\n- Cache not invalidated after mutation\n- Optimistic update not reverted on failure\n- Subscription missed an update\n- Local state diverged from server\n\n**Detection:**\n```typescript\n// Look for mutations without cache invalidation\nawait updateArtifact(id, data);\n// Should have: queryClient.invalidateQueries(['artifact', id])\n```\n\n**User experience:** \"I just saved that, where did it go?\"\n\n## 4. Missing Feedback\n\n**Code:** L3-T5\n**Description:** No visual indication of loading, success, or error.\n\n**Causes:**\n- No loading state during async operation\n- Success not confirmed\n- Error not displayed\n- Progress not shown for long operations\n\n**Detection:**\n```typescript\n// Look for async without loading state\nconst handleSubmit = async () => {\n  await createSource(data);  // User sees nothing during this\n};\n// Should have: setLoading(true) ... setLoading(false)\n```\n\n**User experience:** Uncertainty, repeated clicks, anxiety.\n\n## 5. Context Loss\n\n**Code:** L4-T1\n**Description:** Navigation or action clears important context.\n\n**Causes:**\n- Context not persisted across routes\n- Selection cleared on view change\n- Modal close resets form\n- Back button loses state\n\n**Detection:**\n```typescript\n// Look for context that might be lost\nconst { selectedSources } = useContext(SelectionContext);\n// After navigate(), is selectedSources still there?\n```\n\n**User experience:** Frustration, have to re-select, lost work.\n\n## 6. Race Condition\n\n**Code:** L5-T2\n**Description:** Fast or concurrent actions cause wrong state.\n\n**Causes:**\n- Double-click submits twice\n- Response arrives out of order\n- Rapid toggle causes wrong final state\n\n**Detection:**\n```typescript\n// Look for unprotected rapid actions\nonClick={() => {\n  createItem();  // What if clicked twice fast?\n}}\n// Should have: disabled during operation, or debounce\n```\n\n**User experience:** Duplicates, wrong order, unexpected state.\n\n## 7. Stream Disconnect\n\n**Code:** L6-T3\n**Description:** SSE/WebSocket connection drops mid-operation.\n\n**Causes:**\n- Network interruption\n- Server timeout\n- Client navigates away\n- Mobile sleep/wake\n\n**Detection:**\n```typescript\n// Look for stream handling without error recovery\nconst es = new EventSource('/api/stream');\nes.onmessage = handleChunk;\n// Should have: es.onerror with reconnection logic\n```\n\n**User experience:** Partial content, hanging state, confusion.\n\n## 8. Callback Leak\n\n**Code:** L5-T3\n**Description:** Event listeners accumulate, causing slowdown.\n\n**Causes:**\n- useEffect cleanup missing\n- Event listener not removed\n- Subscription not unsubscribed\n- Interval not cleared\n\n**Detection:**\n```typescript\n// Look for effects without cleanup\nuseEffect(() => {\n  window.addEventListener('resize', handleResize);\n  // Missing: return () => window.removeEventListener(...)\n}, []);\n```\n\n**User experience:** Gradual slowdown, high memory, eventual crash.\n\n## Pattern Checklist\n\nFor each UI pipeline step, check:\n\n- [ ] Dead Click: Could this action fail silently?\n- [ ] Stale Closure: Are callbacks using fresh state?\n- [ ] State Desync: Is cache invalidated after changes?\n- [ ] Missing Feedback: Is there loading/success/error indication?\n- [ ] Context Loss: Is state preserved across navigation?\n- [ ] Race Condition: What if this is triggered rapidly?\n- [ ] Stream Disconnect: Is streaming connection resilient?\n- [ ] Callback Leak: Are effects cleaned up properly?\n"
    },
    {
      "name": "ui-failure-template.md",
      "path": "references/ui-failure-template.md",
      "content": "# UI Failure Mode Template\n\nStandard format for documenting UI failure modes.\n\n## Full Template\n\n```markdown\n### U{N}-{NNN}: {Short description}\n\n| Attribute | Value |\n|-----------|-------|\n| **ID** | U{N}-{NNN} |\n| **Pipeline** | U{N}: {Pipeline Name} |\n| **Step** | {Step number}. {Step description} |\n| **Location** | L{N}-{Name} |\n| **Type** | T{N}-{Name} |\n| **Severity** | S{N}-{Name} |\n| **Pattern** | {UI pattern name or \"N/A\"} |\n| **Description** | {What goes wrong} |\n| **Impact** | {What user experiences} |\n| **Detection** | {How detected, or \"None\"} |\n| **Status** | VALIDATED | UNVALIDATED |\n| **Handling** | {Code location if validated} |\n| **Test Spec** | TEST-U{N}-{NNN} |\n| **Fix** | {What would fix it} |\n| **Effort** | S | M | L |\n```\n\n## Example: State Desync\n\n```markdown\n### U1-005: Cache not invalidated after edit\n\n| Attribute | Value |\n|-----------|-------|\n| **ID** | U1-005 |\n| **Pipeline** | U1: Chat-to-Edit |\n| **Step** | 9. React Query cache invalidation |\n| **Location** | L3-Output |\n| **Type** | T1-Data |\n| **Severity** | S1-Silent |\n| **Pattern** | State Desync |\n| **Description** | Edit succeeds but React Query cache not invalidated |\n| **Impact** | User sees stale artifact content until manual refresh |\n| **Detection** | None (user must notice stale content) |\n| **Status** | UNVALIDATED |\n| **Handling** | - |\n| **Test Spec** | TEST-U1-005 |\n| **Fix** | Add queryClient.invalidateQueries(['artifact', id]) |\n| **Effort** | S |\n```\n\n## Example: Dead Click\n\n```markdown\n### U2-003: Generate button unresponsive\n\n| Attribute | Value |\n|-----------|-------|\n| **ID** | U2-003 |\n| **Pipeline** | U2: Chat-to-Generate |\n| **Step** | 4. User clicks generate |\n| **Location** | L5-Interaction |\n| **Type** | T2-Logic |\n| **Severity** | S4-Blocking |\n| **Pattern** | Dead Click |\n| **Description** | Generate button click handler throws on missing context |\n| **Impact** | User clicks, nothing happens, thinks app is broken |\n| **Detection** | Console error (not visible to user) |\n| **Status** | UNVALIDATED |\n| **Handling** | - |\n| **Test Spec** | TEST-U2-003 |\n| **Fix** | Add try-catch with user-visible error message |\n| **Effort** | S |\n```\n\n## Example: Stream Disconnect\n\n```markdown\n### U1-008: SSE stream disconnects mid-response\n\n| Attribute | Value |\n|-----------|-------|\n| **ID** | U1-008 |\n| **Pipeline** | U1: Chat-to-Edit |\n| **Step** | 6. SSE stream from agent |\n| **Location** | L6-Streaming |\n| **Type** | T3-Infrastructure |\n| **Severity** | S3-Visible |\n| **Pattern** | Stream Disconnect |\n| **Description** | Network interruption drops SSE connection |\n| **Impact** | Partial response shown, no retry, user confused |\n| **Detection** | EventSource onerror fires |\n| **Status** | UNVALIDATED |\n| **Handling** | - |\n| **Test Spec** | TEST-U1-008 |\n| **Fix** | Add reconnection logic with resume from last event ID |\n| **Effort** | M |\n```\n\n## Minimal Template\n\n```markdown\n### U{N}-{NNN}: {Description}\n\n**Location:** L{N} | **Type:** T{N} | **Severity:** S{N}\n**Pattern:** {Pattern or N/A}\n**Status:** VALIDATED | UNVALIDATED\n```\n\n## Pattern Field\n\nInclude pattern when it matches one of the 8 UI patterns:\n\n| Pattern | Use When |\n|---------|----------|\n| Dead Click | User action has no visible response |\n| Stale Closure | Callback uses outdated state |\n| State Desync | UI shows stale data |\n| Missing Feedback | No loading/success/error |\n| Context Loss | State lost on navigation |\n| Race Condition | Rapid actions cause issues |\n| Stream Disconnect | Real-time connection fails |\n| Callback Leak | Event listeners accumulate |\n\nIf none apply, use \"N/A\".\n"
    }
  ],
  "tags": [
    "audit",
    "failure-modes",
    "mece",
    "ui",
    "frontend",
    "analysis"
  ],
  "dependsOn": [
    "ui-pipeline-discovery"
  ]
}