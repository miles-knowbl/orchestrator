{
  "id": "prereq-checker",
  "name": "prereq-checker",
  "version": "1.0.0",
  "description": "Validates prerequisites for async operation. Ensures Slack is configured, modules are available for work, and system is ready for autonomous execution.",
  "phase": "INIT",
  "category": "operations",
  "content": "# Prereq Checker\n\nValidates that all prerequisites for async operation are met before proceeding.\n\n## When to Use\n\n- After state-loader completes\n- Before entering async/mobile mode\n- To validate system readiness for autonomous operation\n\n## Prerequisites Checked\n\n### 1. Slack Configuration\n\n| Check | Required | Fallback |\n|-------|----------|----------|\n| Bot token configured | Yes | Abort |\n| App token configured | Yes (for Socket Mode) | Abort |\n| Channel ID set | Yes | Abort |\n| User ID set | Yes (for @mentions) | Warn |\n| Connection test passes | Yes | Abort |\n\n### 2. Module Availability\n\n| Check | Required | Fallback |\n|-------|----------|----------|\n| At least 1 unblocked module | Yes | Abort |\n| Roadmap accessible | Yes | Abort |\n| Dream state accessible | Yes | Warn |\n\n### 3. System Health\n\n| Check | Required | Fallback |\n|-------|----------|----------|\n| No git conflicts | Yes | Abort |\n| No uncommitted changes | No | Warn |\n| Server healthy | Yes | Abort |\n| Memory writable | Yes | Abort |\n\n### 4. Configuration Validity\n\n| Check | Required | Fallback |\n|-------|----------|----------|\n| Autonomous mode configured | Yes | Use defaults |\n| Tick interval reasonable | Yes | Use default (60s) |\n| Max parallel reasonable | Yes | Use default (1) |\n\n## Workflow\n\n### Step 1: Load State\n\nRead `memory/async-state.json` from state-loader output.\n\n### Step 2: Check Slack\n\n```typescript\n// Verify config exists\nconst slackConfig = state.config.slack;\nif (!slackConfig.botToken || !slackConfig.channelId) {\n  return { valid: false, error: 'SLACK_NOT_CONFIGURED' };\n}\n\n// Test connection\nconst testResult = await testSlackConnection(slackConfig);\nif (!testResult.success) {\n  return { valid: false, error: 'SLACK_CONNECTION_FAILED' };\n}\n```\n\n### Step 3: Check Modules\n\n```typescript\n// Get available modules from roadmap\nconst modules = await roadmapService.getModulesNeedingAttention();\nconst unblocked = modules.filter(m => m.blockedBy.length === 0);\n\nif (unblocked.length === 0) {\n  return { valid: false, error: 'NO_AVAILABLE_MODULES' };\n}\n```\n\n### Step 4: Check System Health\n\n```typescript\n// Health checks\nconst health = {\n  git: !state.git.conflict_state,\n  server: await healthCheck(),\n  memory: await testMemoryWritable()\n};\n\nif (!health.git || !health.server || !health.memory) {\n  return { valid: false, error: 'SYSTEM_UNHEALTHY', details: health };\n}\n```\n\n### Step 5: Compile Results\n\n```json\n{\n  \"valid\": true,\n  \"checks\": {\n    \"slack\": { \"passed\": true },\n    \"modules\": { \"passed\": true, \"available\": 3 },\n    \"system\": { \"passed\": true },\n    \"config\": { \"passed\": true }\n  },\n  \"warnings\": [\"Uncommitted changes detected\"],\n  \"ready_for_async\": true\n}\n```\n\n## Output\n\nUpdates `memory/async-state.json` with prereq results:\n\n```json\n{\n  \"prerequisites\": {\n    \"checked_at\": \"ISO-timestamp\",\n    \"valid\": true,\n    \"checks\": { ... },\n    \"warnings\": [ ... ],\n    \"ready_for_async\": true\n  }\n}\n```\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Updated async state | `memory/async-state.json` | Always |\n\n## Error Handling\n\n| Error | Recovery Action |\n|-------|-----------------|\n| `SLACK_NOT_CONFIGURED` | Guide user to configure Slack |\n| `SLACK_CONNECTION_FAILED` | Check network, token validity |\n| `NO_AVAILABLE_MODULES` | All work complete or blocked |\n| `SYSTEM_UNHEALTHY` | Show which health check failed |\n\n## References\n\n- [prereq-checklist.md](references/prereq-checklist.md) — Complete checklist with remediation steps",
  "references": [
    {
      "name": "prereq-checklist.md",
      "path": "references/prereq-checklist.md",
      "content": "# Async Prerequisites Checklist\n\nComplete checklist for async operation readiness with remediation steps.\n\n## Slack Prerequisites\n\n### Bot Token\n- **Check:** `SLACK_BOT_TOKEN` environment variable or config file\n- **How to get:** Slack App → OAuth & Permissions → Bot User OAuth Token\n- **Format:** `xoxb-...`\n- **Remediation:** Create Slack app, add bot scopes, install to workspace\n\n### App Token (Socket Mode)\n- **Check:** `SLACK_APP_TOKEN` environment variable or config file\n- **How to get:** Slack App → Basic Information → App-Level Tokens\n- **Format:** `xapp-...`\n- **Scopes needed:** `connections:write`\n- **Remediation:** Generate new app-level token with connections:write scope\n\n### Channel ID\n- **Check:** Config file `data/proactive-messaging/proactive-messaging-config.json`\n- **How to get:** Right-click channel → View channel details → Copy ID\n- **Format:** `C...` (public) or `G...` (private)\n- **Remediation:** Add channel ID to config, ensure bot is invited to channel\n\n### User ID (for @mentions)\n- **Check:** Config file `slackUserId` field\n- **How to get:** Click your name → Profile → More → Copy member ID\n- **Format:** `U...`\n- **Remediation:** Add user ID to config\n\n### Connection Test\n- **Check:** `POST /api/slack/test` or `mcp__orchestrator__test_messaging_channel`\n- **Expected:** Message appears in channel\n- **Remediation:** Check all tokens, ensure bot invited to channel\n\n## Module Prerequisites\n\n### Available Modules\n- **Check:** `GET /api/roadmap/modules?status=available`\n- **Expected:** At least 1 module with no blockers\n- **Remediation:** Review roadmap, unblock dependencies, or defer work\n\n### Roadmap Accessible\n- **Check:** `ROADMAP.md` exists and parseable\n- **Expected:** Valid markdown with module definitions\n- **Remediation:** Fix roadmap syntax errors\n\n### Dream State Accessible\n- **Check:** `.claude/DREAM-STATE.md` exists\n- **Expected:** Valid dream state document\n- **Remediation:** Run `/dream-loop` to create/update\n\n## System Health\n\n### No Git Conflicts\n- **Check:** `git status` shows no conflicts\n- **Expected:** Clean or only uncommitted changes\n- **Remediation:** Resolve conflicts manually: `git mergetool`\n\n### Server Healthy\n- **Check:** `GET /health` returns 200\n- **Expected:** `{\"status\":\"ok\"}`\n- **Remediation:** `npm start` or check error logs\n\n### Memory Writable\n- **Check:** Can write to `memory/` directory\n- **Expected:** Write succeeds\n- **Remediation:** Check permissions: `chmod 755 memory/`\n\n## Configuration\n\n### Autonomous Mode\n```json\n{\n  \"enabled\": true,\n  \"tickInterval\": 60000,\n  \"maxParallel\": 1,\n  \"maxRetries\": 3\n}\n```\n\n### Recommended Settings for Mobile\n\n| Setting | Value | Reason |\n|---------|-------|--------|\n| `tickInterval` | 60000 (1 min) | Balance between responsiveness and battery |\n| `maxParallel` | 1 | Avoid conflicts when mobile |\n| `maxRetries` | 3 | Auto-recover from transient failures |\n\n## Quick Validation Command\n\n```bash\n# Run all prereq checks\ncurl -s http://localhost:3002/api/async/prereqs | jq .\n\n# Expected output\n{\n  \"valid\": true,\n  \"slack\": \"connected\",\n  \"modules\": 3,\n  \"health\": \"ok\"\n}\n```\n\n## Common Issues\n\n### \"Slack connection failed\"\n1. Check bot token hasn't expired\n2. Verify bot is still in workspace\n3. Check network connectivity\n4. Regenerate tokens if needed\n\n### \"No available modules\"\n1. All modules complete (good!)\n2. All remaining modules blocked\n3. Roadmap not parsed correctly\n4. Check `GET /api/roadmap/modules` for details\n\n### \"System unhealthy\"\n1. Server not running\n2. Port conflict (3002 in use)\n3. Memory directory permissions\n4. Disk full\n"
    }
  ],
  "tags": [
    "async",
    "validation",
    "prerequisites",
    "readiness"
  ],
  "dependsOn": [
    "state-loader"
  ]
}