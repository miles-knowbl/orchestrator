{
  "id": "handoff-confirmer",
  "name": "handoff-confirmer",
  "version": "1.0.0",
  "description": "Confirms system is ready for async handoff. Performs final validation and produces handoff summary before entering mobile operation mode.",
  "phase": "HANDOFF",
  "category": "operations",
  "content": "# Handoff Confirmer\n\nFinal confirmation that system is ready for async operation.\n\n## When to Use\n\n- Final step of async-loop\n- After all verifications pass\n- To produce handoff summary and enter async mode\n\n## What It Confirms\n\n### Readiness Checklist\n\n| Check | Source | Required |\n|-------|--------|----------|\n| State loaded | state-loader | Yes |\n| Prerequisites met | prereq-checker | Yes |\n| Context gathered | dream-sync, etc. | Yes |\n| Queue built | queue-builder | Yes |\n| Slack working | slack-validator | Yes |\n| Notifications working | notification-tester | Yes |\n\n### Handoff Package\n\nEverything needed for async operation:\n- Work queue (memory/async-queue.json)\n- Context cache (memory/async-context.json)\n- State snapshot (memory/async-state.json)\n\n## Workflow\n\n### Step 1: Verify All Prior Steps\n\n```typescript\nconst checks = {\n  state: await verifyFile('memory/async-state.json'),\n  context: await verifyFile('memory/async-context.json'),\n  queue: await verifyFile('memory/async-queue.json'),\n  slack: execution.gates['verify-gate']?.status === 'approved'\n};\n\nif (!Object.values(checks).every(Boolean)) {\n  return { ready: false, missing: getMissing(checks) };\n}\n```\n\n### Step 2: Load Queue Summary\n\n```typescript\nconst queue = await loadJSON('memory/async-queue.json');\nconst summary = {\n  moves: queue.queue.items.length,\n  first_move: queue.queue.items[0],\n  estimated_hours: queue.totals.estimated_hours,\n  human_gates: queue.totals.human_gates\n};\n```\n\n### Step 3: Calculate Autonomous Duration\n\nHow long until human intervention needed:\n\n```typescript\nfunction calculateAutonomousDuration(queue) {\n  let hours = 0;\n\n  for (const item of queue.items) {\n    if (item.gates.human > 0) {\n      // Hits human gate\n      return { hours, stops_at: item.module };\n    }\n    hours += item.estimated_hours;\n  }\n\n  return { hours, stops_at: null };\n}\n```\n\n### Step 4: Produce Handoff Summary\n\n```\n╔══════════════════════════════════════════════════════════════╗\n║  ASYNC HANDOFF CONFIRMED                                     ║\n╠══════════════════════════════════════════════════════════════╣\n║                                                              ║\n║  Queue: 7 moves planned                                      ║\n║  First: auth-service (engineering-loop)                      ║\n║  Estimated: 15.5 hours total                                 ║\n║                                                              ║\n║  Autonomous Duration: 3.5 hours                              ║\n║  First Human Gate: auth-service @ REVIEW                     ║\n║                                                              ║\n║  Slack Channel: #orchestrator                                ║\n║  Notifications: Enabled (@mention on gates)                  ║\n║                                                              ║\n║  Commands available via Slack:                               ║\n║    \"start next\" — Begin first queue item                     ║\n║    \"status\"     — Show current progress                      ║\n║    \"approved\"   — Approve current gate                       ║\n║    \"pause\"      — Pause execution                            ║\n║                                                              ║\n║  Ready for mobile operation.                                 ║\n╚══════════════════════════════════════════════════════════════╝\n```\n\n### Step 5: Send Slack Notification\n\n```typescript\nawait messagingService.notify({\n  type: 'handoff_complete',\n  channel: 'slack',\n  message: `Async handoff complete. Queue: ${summary.moves} moves. Say \"start next\" to begin.`,\n  buttons: [\n    { text: 'Start Next', action: 'start_next' },\n    { text: 'Show Queue', action: 'show_queue' }\n  ]\n});\n```\n\n### Step 6: Update State\n\n```typescript\nawait updateAsyncState({\n  mode: 'async',\n  handoff_at: new Date().toISOString(),\n  queue_position: 0,\n  status: 'ready'\n});\n```\n\n## Output\n\nUpdates `memory/async-state.json`:\n\n```json\n{\n  \"mode\": \"async\",\n  \"handoff_at\": \"ISO-timestamp\",\n  \"handoff_summary\": {\n    \"queue_size\": 7,\n    \"estimated_hours\": 15.5,\n    \"autonomous_hours\": 3.5,\n    \"first_human_gate\": {\n      \"module\": \"auth-service\",\n      \"gate\": \"REVIEW\"\n    }\n  },\n  \"status\": \"ready\",\n  \"awaiting_command\": true\n}\n```\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Updated async state | `memory/async-state.json` | Always |\n| Slack notification | Slack channel | If enabled |\n\n## Completion Message\n\nThe loop ends with:\n\n```\nReady for async operation. Go mobile and use 'Start Next' on Slack.\n```\n\n## Post-Handoff Operation\n\nAfter handoff, the system:\n1. Waits for \"start next\" command\n2. Executes queue items in order\n3. Notifies on gates\n4. Pauses on human gates\n5. Continues when approved\n\n## References\n\n- [async-commands.md](references/async-commands.md) — Slack commands for async operation",
  "references": [
    {
      "name": "async-commands.md",
      "path": "references/async-commands.md",
      "content": "# Async Commands\n\nSlack commands available during async operation.\n\n## Command Reference\n\n### start next\n\nBegins the next item in the queue.\n\n**Usage:** `start next` or `go`\n\n**Response:**\n```\nStarting: auth-service (engineering-loop)\nEstimated duration: 3.5 hours\nFirst human gate: REVIEW phase\n\nI'll notify you when the gate is reached.\n```\n\n### status\n\nShows current execution status.\n\n**Usage:** `status` or `show status`\n\n**Response:**\n```\nCurrent Status\n\nExecuting: auth-service\nPhase: IMPLEMENT\nProgress: 2/6 phases complete\nDuration: 45 minutes\n\nQueue: 6 more items remaining\nNext: api-endpoints\n```\n\n### approved\n\nApproves the current waiting gate.\n\n**Usage:** `approved` or `approve`\n\n**Requires:** Gate currently waiting\n\n**Response:**\n```\nGate approved: code-review-gate\nContinuing execution...\n```\n\n### rejected [reason]\n\nRejects the current waiting gate.\n\n**Usage:** `rejected Need more tests` or `reject`\n\n**Requires:** Gate currently waiting\n\n**Response:**\n```\nGate rejected: code-review-gate\nReason: Need more tests\nExecution paused. Review feedback logged.\n```\n\n### pause\n\nPauses current execution.\n\n**Usage:** `pause`\n\n**Response:**\n```\nExecution paused.\nCurrent state: IMPLEMENT phase, 45 minutes in\nResume with \"resume\" when ready.\n```\n\n### resume\n\nResumes paused execution.\n\n**Usage:** `resume`\n\n**Response:**\n```\nResuming execution...\nContinuing from: IMPLEMENT phase\n```\n\n### skip\n\nSkips the current queue item.\n\n**Usage:** `skip` or `skip [reason]`\n\n**Response:**\n```\nSkipping: auth-service\nReason: Will revisit later\nMoving to: api-endpoints\n```\n\n### show queue\n\nDisplays the full queue.\n\n**Usage:** `show queue` or `queue`\n\n**Response:**\n```\nAsync Queue (7 items)\n\n1. [active] auth-service (3.5h)\n2. [pending] api-endpoints (2h)\n3. [pending] user-dashboard (3h)\n...\n\nTotal estimated: 15.5 hours\nHuman gates: 4\n```\n\n### show details\n\nShows details for current or specified item.\n\n**Usage:** `show details` or `details auth-service`\n\n**Response:**\n```\nauth-service Details\n\nLoop: engineering-loop\nLeverage: 8.2\nEstimated: 3.5 hours\nGates: 3 (2 auto, 1 human)\nHuman gate at: REVIEW phase\n\nUnlocks: api-endpoints, user-dashboard\n```\n\n## Command Shortcuts\n\n| Full Command | Shortcut |\n|--------------|----------|\n| `start next` | `go` |\n| `status` | `s` |\n| `approved` | `ok`, `approve` |\n| `rejected` | `no`, `reject` |\n| `show queue` | `q` |\n| `show details` | `d` |\n\n## Button Actions\n\nSome commands are also available as buttons:\n\n| Button | Command | Context |\n|--------|---------|---------|\n| [Start Next] | `start next` | Handoff notification |\n| [Approve] | `approved` | Gate notification |\n| [Reject] | `rejected` | Gate notification |\n| [View Details] | `show details` | Any notification |\n| [Pause] | `pause` | Status notification |\n\n## Natural Language\n\nThe command parser also understands:\n- \"let's go\" → `start next`\n- \"looks good\" → `approved`\n- \"what's happening\" → `status`\n- \"hold on\" → `pause`\n- \"continue\" → `resume`\n\n## Error Messages\n\n### No execution active\n```\nNo execution currently active. Use \"start next\" to begin.\n```\n\n### No gate waiting\n```\nNo gate currently waiting for approval.\nCurrent status: Executing IMPLEMENT phase\n```\n\n### Unknown command\n```\nI didn't understand that. Try:\n• status — Show current state\n• start next — Begin next item\n• approved — Approve waiting gate\n```\n"
    }
  ],
  "tags": [
    "async",
    "handoff",
    "confirmation",
    "mobile"
  ],
  "dependsOn": [
    "queue-builder",
    "notification-tester"
  ]
}