{
  "id": "leverage-calculator",
  "name": "leverage-calculator",
  "version": "1.0.0",
  "description": "Calculates leverage scores for queue planning. Uses the leverage protocol to determine optimal work ordering for async operation.",
  "phase": "PLAN",
  "category": "strategy",
  "content": "# Leverage Calculator\n\nApplies the leverage protocol to determine optimal work ordering.\n\n## When to Use\n\n- During async-loop PLAN phase\n- After modules have been scored\n- To create prioritized work queue\n\n## Leverage Protocol\n\n### Value Equation\n\n```\n       (DSA × 0.40) + (Downstream Unlock × 0.25) + (Likelihood × 0.15)\nV = ─────────────────────────────────────────────────────────────────────\n                    (Time × 0.10) + (Effort × 0.10)\n```\n\n### Multi-Move Planning\n\nBeyond single-move leverage, consider:\n- What completing this unlocks\n- Sequence optimization (loop chains)\n- Compound leverage across moves\n\n## Workflow\n\n### Step 1: Load Scored Modules\n\n```typescript\nconst scores = await loadJSON('memory/module-scores.json');\nconst ranked = scores.ranked_modules;\n```\n\n### Step 2: Calculate Compound Leverage\n\nFor top candidates, calculate multi-move value:\n\n```typescript\nfunction calculateCompoundLeverage(module, depth = 3) {\n  let totalValue = module.leverage_score;\n\n  // Look ahead\n  const unlocks = getUnlockedModules(module);\n  for (const unlocked of unlocks.slice(0, depth)) {\n    const nextScore = calculateLeverage(unlocked);\n    totalValue += nextScore * (0.5 ** depth); // Discount future\n  }\n\n  return totalValue;\n}\n```\n\n### Step 3: Consider Loop Sequences\n\nApply loop sequencing patterns:\n\n```typescript\nconst sequences = await loopSequencingService.getTransitions();\nconst optimalSequence = sequences.find(seq =>\n  seq.fromLoop === lastCompletedLoop &&\n  seq.confidence > 0.7\n);\n\nif (optimalSequence) {\n  // Boost modules that match expected next loop\n  ranked.forEach(m => {\n    if (m.recommended_loop === optimalSequence.toLoop) {\n      m.leverage_score *= 1.2; // 20% boost\n    }\n  });\n}\n```\n\n### Step 4: Build Leverage Report\n\n```json\n{\n  \"leverage_calculation\": {\n    \"calculated_at\": \"ISO-timestamp\",\n    \"top_moves\": [\n      {\n        \"rank\": 1,\n        \"module\": \"auth-service\",\n        \"leverage_score\": 8.2,\n        \"compound_leverage\": 12.5,\n        \"unlocks\": [\"api-endpoints\", \"user-dashboard\"],\n        \"recommended_loop\": \"engineering-loop\",\n        \"reasoning\": \"High DSA (9/10), unblocks 2 modules\"\n      }\n    ],\n    \"sequence_recommendation\": {\n      \"line\": [\"auth-service\", \"api-endpoints\", \"user-dashboard\"],\n      \"compound_value\": 18.7,\n      \"estimated_hours\": 10.5\n    }\n  }\n}\n```\n\n## Output\n\nUpdates `memory/async-queue.json` with leverage calculations:\n\n```json\n{\n  \"leverage\": {\n    \"calculated_at\": \"ISO-timestamp\",\n    \"single_move_best\": {\n      \"module\": \"auth-service\",\n      \"score\": 8.2\n    },\n    \"multi_move_best\": {\n      \"line\": [\"auth-service\", \"api-endpoints\"],\n      \"compound_score\": 12.5\n    },\n    \"top_5\": [...]\n  }\n}\n```\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Async queue file | `memory/async-queue.json` | Always |\n\n## Compound Leverage Calculation\n\n### Discount Factor\n\nFuture value is discounted:\n- Move 1: 100% value\n- Move 2: 50% value\n- Move 3: 25% value\n\n### Chain Value\n\n```typescript\nconst chainValue = moves.reduce((total, move, index) => {\n  const discount = Math.pow(0.5, index);\n  return total + (move.leverage * discount);\n}, 0);\n```\n\n## References\n\n- [leverage-protocol.md](references/leverage-protocol.md) — Full leverage protocol specification",
  "references": [
    {
      "name": "leverage-protocol.md",
      "path": "references/leverage-protocol.md",
      "content": "# Leverage Protocol\n\nFull specification of the leverage calculation system.\n\n## Core Principle\n\n**Always think: \"What's the next highest leverage move?\"**\n\nLeverage = Impact / Effort\n\nHigh leverage moves:\n- Advance dream state significantly\n- Unlock downstream work\n- Are likely to succeed\n- Don't take too long\n\n## Value Equation Components\n\n### Dream State Alignment (DSA) — 40%\n\nHow directly does this move the checklist toward \"done\"?\n\n| Score | Criteria |\n|-------|----------|\n| 10 | Directly completes dream state milestone |\n| 8 | Major progress on critical path |\n| 6 | Meaningful advancement |\n| 4 | Incremental progress |\n| 2 | Tangential benefit |\n| 0 | No alignment |\n\n### Downstream Unlock — 25%\n\nHow many subsequent moves does this make easier/possible?\n\n| Score | Criteria |\n|-------|----------|\n| 10 | Unblocks 5+ modules |\n| 8 | Unblocks 3-4 modules |\n| 6 | Unblocks 2 modules |\n| 4 | Unblocks 1 module |\n| 2 | Enables easier work |\n| 0 | No downstream impact |\n\n### Likelihood — 15%\n\nCan we actually complete this given current context?\n\n| Score | Criteria |\n|-------|----------|\n| 10 | Done before, clear path |\n| 8 | Similar work succeeded |\n| 6 | Good patterns exist |\n| 4 | Unclear but no blockers |\n| 2 | Known challenges |\n| 0 | Major uncertainty |\n\n### Time Required — 10% (Inverse)\n\nFaster is better.\n\n| Score | Time |\n|-------|------|\n| 10 | < 1 hour |\n| 8 | 1-2 hours |\n| 6 | 2-4 hours |\n| 4 | 4-8 hours |\n| 2 | 1-2 days |\n| 0 | > 2 days |\n\n### Effort Required — 10% (Inverse)\n\nLower friction is better.\n\n| Score | Effort |\n|-------|--------|\n| 10 | Trivial change |\n| 8 | Straightforward |\n| 6 | Moderate complexity |\n| 4 | Significant work |\n| 2 | Major undertaking |\n| 0 | Heroic effort |\n\n## Multi-Move Planning\n\n### Line Thinking\n\nLook multiple moves ahead:\n\n```\nMove 1: auth-service (V: 8.2)\n    └── Move 2: api-endpoints (V: 7.1, unlocked by #1)\n            └── Move 3: user-dashboard (V: 6.5, unlocked by #2)\n```\n\n### Compound Value\n\n```\nCompound V = V₁ + (V₂ × 0.5) + (V₃ × 0.25) + ...\n```\n\n### Chain Selection\n\nChoose the chain with highest compound value, not just the best single move.\n\n## Loop Sequence Patterns\n\nCommon effective sequences:\n\n| Pattern | Description |\n|---------|-------------|\n| engineering → bugfix | Build then fix |\n| bugfix → distribution | Fix then ship |\n| learning → engineering | Learn then apply |\n| engineering → distribution | Build then ship |\n\n## Async-Specific Adjustments\n\n### Mobile Context\n\nWhen operating mobile:\n- Prefer smaller moves (< 2 hours)\n- Avoid moves requiring deep focus\n- Prioritize moves with clear gates\n\n### Autonomy Level\n\nAdjust for human availability:\n- Full autonomy: Can proceed through auto-gates\n- Supervised: Wait at human gates\n- Manual: Require approval at each step\n\n## Decision Framework\n\n1. Calculate single-move leverage for all candidates\n2. For top 3, calculate compound leverage\n3. Consider loop sequence patterns\n4. Apply async-specific adjustments\n5. Select highest compound value\n"
    }
  ],
  "tags": [
    "async",
    "leverage",
    "planning",
    "prioritization"
  ],
  "dependsOn": [
    "module-scorer",
    "blocker-analyzer"
  ]
}