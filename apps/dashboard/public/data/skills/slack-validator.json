{
  "id": "slack-validator",
  "name": "slack-validator",
  "version": "1.0.0",
  "description": "Validates Slack connection and configuration for async operation. Ensures bidirectional communication is working before handoff.",
  "phase": "VERIFY",
  "category": "operations",
  "content": "# Slack Validator\n\nValidates that Slack integration is properly configured and working.\n\n## When to Use\n\n- During async-loop VERIFY phase\n- Before entering mobile/async operation\n- To confirm bidirectional Slack communication\n\n## What It Validates\n\n### Configuration\n\n| Check | Required | Test |\n|-------|----------|------|\n| Bot token | Yes | Token format valid |\n| App token | Yes | Token format valid |\n| Channel ID | Yes | Channel exists |\n| User ID | Yes | User can be mentioned |\n| Socket Mode | Yes | Connection established |\n\n### Connectivity\n\n| Check | Required | Test |\n|-------|----------|------|\n| Can send | Yes | Test message delivered |\n| Can receive | Yes | Button click received |\n| Can @mention | Yes | User mentioned successfully |\n\n### Features\n\n| Check | Required | Test |\n|-------|----------|------|\n| Block Kit | Yes | Buttons render |\n| Threading | Yes | Reply to thread works |\n| Reactions | No | Can add reactions |\n\n## Workflow\n\n### Step 1: Validate Configuration\n\n```typescript\nconst config = await loadSlackConfig();\n\nconst configChecks = {\n  botToken: config.botToken?.startsWith('xoxb-'),\n  appToken: config.appToken?.startsWith('xapp-'),\n  channelId: config.channelId?.match(/^[CG]/),\n  userId: config.slackUserId?.startsWith('U')\n};\n\nif (!Object.values(configChecks).every(Boolean)) {\n  return { valid: false, error: 'INVALID_CONFIG', details: configChecks };\n}\n```\n\n### Step 2: Test Connection\n\n```typescript\n// Test socket connection\nconst socketHealth = await slackAdapter.checkConnection();\n\nif (!socketHealth.connected) {\n  return { valid: false, error: 'CONNECTION_FAILED' };\n}\n```\n\n### Step 3: Send Test Message\n\n```typescript\nconst testMessage = await slackAdapter.sendMessage({\n  channel: config.channelId,\n  text: \"Async validation test\",\n  blocks: [\n    {\n      type: \"section\",\n      text: { type: \"mrkdwn\", text: \"*Async Loop Validation*\\nTesting communication...\" }\n    },\n    {\n      type: \"actions\",\n      elements: [\n        {\n          type: \"button\",\n          text: { type: \"plain_text\", text: \"Confirm Receipt\" },\n          action_id: \"async_validation_confirm\"\n        }\n      ]\n    }\n  ]\n});\n\nif (!testMessage.ok) {\n  return { valid: false, error: 'SEND_FAILED' };\n}\n```\n\n### Step 4: Wait for Confirmation (Optional)\n\nIf running interactively:\n```typescript\nconst confirmation = await waitForButtonClick(\n  'async_validation_confirm',\n  timeout: 60000\n);\n```\n\n### Step 5: Report Results\n\n```json\n{\n  \"slack_validation\": {\n    \"validated_at\": \"ISO-timestamp\",\n    \"config_valid\": true,\n    \"connection_valid\": true,\n    \"send_valid\": true,\n    \"receive_valid\": true,\n    \"overall_valid\": true,\n    \"test_message_ts\": \"1234567890.123456\"\n  }\n}\n```\n\n## Output\n\nUpdates execution state with validation results.\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Validation report | Execution logs | Always |\n\n## Error Recovery\n\n| Error | Recovery Action |\n|-------|-----------------|\n| `INVALID_CONFIG` | Guide to fix configuration |\n| `CONNECTION_FAILED` | Check network, regenerate tokens |\n| `SEND_FAILED` | Verify bot in channel |\n| `RECEIVE_FAILED` | Check Socket Mode enabled |\n\n## References\n\n- [slack-setup.md](references/slack-setup.md) — Slack app setup guide",
  "references": [
    {
      "name": "slack-setup.md",
      "path": "references/slack-setup.md",
      "content": "# Slack Setup Guide\n\nHow to configure Slack for async orchestrator operation.\n\n## Create Slack App\n\n1. Go to https://api.slack.com/apps\n2. Click \"Create New App\"\n3. Choose \"From scratch\"\n4. Name: \"Orchestrator\" (or your preference)\n5. Select workspace\n\n## Configure Bot Scopes\n\n### Required OAuth Scopes\n\nNavigate to: OAuth & Permissions → Scopes → Bot Token Scopes\n\n| Scope | Purpose |\n|-------|---------|\n| `chat:write` | Send messages |\n| `chat:write.public` | Send to public channels |\n| `users:read` | Lookup user info |\n| `channels:read` | Read channel info |\n| `groups:read` | Read private channel info |\n\n### Install to Workspace\n\n1. Click \"Install to Workspace\"\n2. Authorize the permissions\n3. Copy the **Bot User OAuth Token** (`xoxb-...`)\n\n## Enable Socket Mode\n\nNavigate to: Socket Mode\n\n1. Enable Socket Mode\n2. Generate App-Level Token with `connections:write` scope\n3. Copy the **App-Level Token** (`xapp-...`)\n\n## Enable Interactive Components\n\nNavigate to: Interactivity & Shortcuts\n\n1. Turn on \"Interactivity\"\n2. Request URL not needed for Socket Mode\n\n## Configure Event Subscriptions\n\nNavigate to: Event Subscriptions\n\n1. Enable Events\n2. Subscribe to bot events:\n   - `message.channels`\n   - `message.groups`\n   - `app_mention`\n\n## Get Channel ID\n\n1. Right-click the channel name in Slack\n2. Click \"View channel details\"\n3. Scroll to bottom, copy Channel ID (`C...` or `G...`)\n\n## Get User ID\n\n1. Click your name in Slack\n2. Click \"Profile\"\n3. Click the \"...\" menu\n4. Click \"Copy member ID\" (`U...`)\n\n## Configure Orchestrator\n\nCreate/update `data/proactive-messaging/proactive-messaging-config.json`:\n\n```json\n{\n  \"channels\": {\n    \"slack\": {\n      \"enabled\": true,\n      \"botToken\": \"xoxb-YOUR-TOKEN\",\n      \"appToken\": \"xapp-YOUR-TOKEN\",\n      \"channelId\": \"C0XXXXXXX\",\n      \"socketMode\": true,\n      \"slackUserId\": \"U0XXXXXXX\"\n    }\n  }\n}\n```\n\nOr use environment variables:\n```bash\nexport SLACK_BOT_TOKEN=xoxb-...\nexport SLACK_APP_TOKEN=xapp-...\n```\n\n## Test Connection\n\n```bash\n# Check health\ncurl http://localhost:3002/api/slack/channels\n\n# Send test message\ncurl -X POST http://localhost:3002/api/messaging/test \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"channel\": \"slack\", \"message\": \"Test\"}'\n```\n\n## Troubleshooting\n\n### \"not_in_channel\"\n\nThe bot needs to be invited to the channel:\n1. In Slack, go to the channel\n2. Type `/invite @Orchestrator`\n\n### \"invalid_auth\"\n\nToken is invalid or expired:\n1. Go to OAuth & Permissions\n2. Reinstall app to workspace\n3. Copy new token\n\n### Socket Mode not connecting\n\n1. Verify App-Level Token has `connections:write`\n2. Check Socket Mode is enabled\n3. Regenerate App-Level Token if needed\n\n### Buttons not working\n\n1. Verify Interactivity is enabled\n2. Check Socket Mode (no URL needed)\n3. Verify event subscriptions configured\n"
    }
  ],
  "tags": [
    "async",
    "slack",
    "validation",
    "communication"
  ],
  "dependsOn": [
    "prereq-checker"
  ]
}