{
  "id": "coordination-protocol",
  "name": "coordination-protocol",
  "version": "1.0.0",
  "description": "Define communication patterns and handoff protocols for multi-agent orchestration with locks, heartbeats, and conflict resolution.",
  "phase": "COMPLETE",
  "category": "meta",
  "content": "# Coordination Protocol\n\nDefine communication and handoff protocols for multi-agent orchestration.\n\n## When to Use\n\n- **Multi-agent workflows** — Multiple agents working on the same project\n- **Concurrent skill execution** — Parallel phases need coordination\n- **Handoff between sessions** — One agent picks up where another left off\n- When you say: \"coordinate agents\", \"handoff protocol\", \"conflict resolution\"\n\n## Required Deliverables\n\n| Deliverable | Location | Condition |\n|-------------|----------|-----------|\n| Coordination config | `memory/coordination.json` | When multi-agent |\n| Handoff document | `HANDOFF.md` | On session end |\n\n## Core Concept\n\nCoordination answers: **\"How do multiple agents work on the same project without conflicts?\"**\n\n```\nAgent A ─── acquires lock ─── works ─── releases lock ─── handoff\n                                                            ↓\nAgent B ─────────── waits ─────────────────────── acquires lock ─── works\n```\n\n## Lock Protocol\n\n```typescript\ninterface Lock {\n  resource: string;     // File path or resource ID\n  holder: string;       // Agent/session ID\n  acquired: string;     // ISO timestamp\n  expires: string;      // Auto-release time\n  purpose: string;      // What the holder is doing\n}\n```\n\n### Lock Rules\n\n1. **Acquire before modifying** — Always lock files before editing\n2. **Short-lived locks** — Maximum 5 minutes, renewable\n3. **Auto-release on timeout** — Prevents deadlocks from crashed agents\n4. **Conflict detection** — Report conflicts immediately, don't silently overwrite\n\n## Handoff Protocol\n\nWhen transferring work between sessions:\n\n```markdown\n## Handoff Document\n\n### Current State\n- Phase: IMPLEMENT\n- Last completed skill: scaffold\n- Pending: implement skill\n\n### In Progress\n- File: src/services/auth.ts (50% complete)\n- Blocked on: API design decision\n\n### Decisions Made\n- Using JWT over session tokens (see ADR-001)\n- PostgreSQL for persistence\n\n### Next Steps\n1. Complete auth service implementation\n2. Add middleware integration\n3. Run test-generation skill\n```\n\n## Heartbeat Pattern\n\n```typescript\ninterface Heartbeat {\n  agentId: string;\n  timestamp: string;\n  phase: string;\n  activeSkill: string;\n  filesLocked: string[];\n}\n```\n\nAgents emit heartbeats every 30 seconds. If no heartbeat for 2 minutes, locks are released.\n\n## Conflict Resolution\n\n| Conflict | Resolution | Priority |\n|----------|------------|----------|\n| Same file, same section | Last writer warns, merge required | High |\n| Same file, different sections | Auto-merge | Low |\n| Different files | No conflict | None |\n| Schema change | Exclusive lock required | Critical |\n\n## Checklist\n\n- [ ] Lock protocol defined for shared resources\n- [ ] Handoff document created at session end\n- [ ] Heartbeat interval configured\n- [ ] Conflict resolution strategy documented\n- [ ] Auto-release timeouts prevent deadlocks\n\n## Relationship to Other Skills\n\n| Skill | Relationship |\n|-------|--------------|\n| `memory-manager` | Coordination state stored in memory |\n| `loop-controller` | Controller manages agent assignments |\n| `journey-tracer` | Coordination events logged in journey |\n| `retrospective` | Multi-agent coordination reviewed in retro |\n\n## Key Principles\n\n**Explicit handoffs.** Never assume another agent knows the context — write it down.\n\n**Short-lived locks.** Acquire late, release early, auto-expire always.\n\n**Conflict prevention over resolution.** Good coordination avoids conflicts entirely.\n\n**Heartbeats prove liveness.** If an agent is silent, assume it's gone.",
  "references": [],
  "tags": [
    "meta",
    "coordination",
    "multi-agent",
    "locking",
    "synchronization"
  ],
  "dependsOn": [
    "memory-manager"
  ]
}